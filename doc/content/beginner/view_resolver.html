<!DOCTYPE html>
<html>
<head><title>View resolver</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>
<link rel="stylesheet" type="text/css" href="../../theme.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web</span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a>

<a href="../../../doc_src/content/beginner/view_resolver.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="web_application_context.html" title="Previous: Web application context"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="model.html" title="Next: Model"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">View resolver</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item"><a href="../../../readme.html">About the course</a></div>
<div class="sidebar_item"><a href="../references.html">References</a></div>
<div class="sidebar_item"><a href="../common_notes.html">Common notes</a></div>
            <h3>Beginner</h3>
            <div class="sidebar_item"><a href="about_part_1.html">About this part</a></div>
<div class="sidebar_item"><a href="server_setup.html">Server setup</a></div>
<div class="sidebar_item"><a href="front_controller.html">Front controller</a></div>
<div class="sidebar_item"><a href="spring_web_app_setup.html">Spring web application setup</a></div>
<div class="sidebar_item"><a href="web_application_context.html">Web application context</a></div>
<div class="sidebar_item selected"><a href="view_resolver.html">View resolver</a></div>
<div class="sidebar_item"><a href="model.html">Model</a></div>
            <h3>Intermediate</h3>
            <div class="sidebar_item"><a href="../intermediate/about_part_2.html">About this part</a></div>
<div class="sidebar_item"><a href="../intermediate/get_rid_of_web_xml.html">Get rid of XML configuration</a></div>
<div class="sidebar_item"><a href="../intermediate/data_binding.html">Data binding</a></div>
<div class="sidebar_item"><a href="../intermediate/registration_form.html">Registration form</a></div>
<div class="sidebar_item"><a href="../intermediate/form_validation.html">Form validation</a></div>
<div class="sidebar_item"><a href="../intermediate/formatters.html">Spring MVC Formatter</a></div>
            <h3>Useful links</h3>
            <div class="sidebar_item"><a href="https://spring.io/">Spring site</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by md2html_py 1.0.2
            <br />2023-03-27 15:01:31
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">View resolver</p>

<div class="toc">
<ul>
<li><a href="#materials">Materials</a></li>
<li><a href="#specifying-direct-view-file-location">Specifying direct view file location</a><ul>
<li><a href="#why-this-is-bad">Why this is bad</a></li>
</ul>
</li>
<li><a href="#using-view-resolver">Using view resolver</a></li>
</ul>
</div>
<hr />
<p>Mar 20, 2023</p>
<h1 id="materials">Materials</h1>
<p>[<a href="../references.html#ref_1_8">1.8</a>]</p>
<hr />
<h1 id="specifying-direct-view-file-location">Specifying direct view file location</h1>
<p>Now we create a new controller <a href="../../../projects/web-app-spring/src/main/java/springmvcstudy/controllers/JspHelloController.java"><code>JspHelloController</code></a>:</p>
<pre class="highlight"><code class="language-code">@Controller
@RequestMapping("/jsp")
public class JspHelloController {

    @RequestMapping("/hello")
    public String getJspHello() {
        return "/view/jspHello.jsp";
    }
}</code></pre>
<p>Here we remove the <code>@ResponseBody</code> annotation that will instruct the Spring MVC framework that
the method return value is not the exact page content but the view file location instead.</p>
<p>A simple JSP file <a href="../../../projects/web-app-spring/src/main/webapp/view/jspHello.jsp"><code>src/main/webapp/view/jspHello.jsp</code></a>
is created:</p>
<pre class="highlight"><code class="language-xml">&lt;html&gt;&lt;body&gt;
&lt;h2&gt;Hello from JSP!&lt;/h2&gt;
&lt;p&gt;The generated servlet class is:
&lt;code&gt;&lt;%= this.getClass().getSimpleName() %&gt;&lt;code&gt;&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In the file <a href="../../../projects/web-app-spring/src/main/webapp/WEB-INF/web.xml"><code>web.xml</code></a>
make sure that servlet mapping URL pattern is <code>/</code>, not <code>/*</code>:</p>
<pre class="highlight"><code class="language-xml">    .  .  .
    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;front-controller&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
    .  .  .</code></pre>
<p>Otherwise the Jetty server shows error 404 in the browser and puts the following error
in the log:</p>
<pre class="highlight"><code class="language-wrapped-shell-error">Mar 20, 2023 11:05:12 AM org.springframework.web.servlet.DispatcherServlet noHandlerFound
WARNING: No mapping for GET /web-app-spring/view/jspHello.jsp</code></pre>
</div>
<p>After navigating to <a href="http://localhost:8080/web-app-spring/jsp/hello">http://localhost:8080/web-app-spring/jsp/hello</a> we see:</p>
<p><img alt="" src="../../pict/using_view_location.png" /></p>
<h2 id="why-this-is-bad">Why this is bad</h2>
<p>This approach doesn't use the standard Spring MVC view resolution mechanism.
The view location is hard coded in the controller and reflects in the page URL. If, for any reason,
the view file location is changed it will need corresponding changes in different parts of the code.
Also we are tied to (in this case) to the JSP technology and it will need a lot of work to switch to 
the other ones.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>JSP pages are processed by the Jetty <code>jsp</code> module added when the server was initially adjusted.
If the file <code>%JETTY_BASE%\start.d\jsp.ini</code> is removed the following error will be logged when
a JSP page is accessed:</p>
<pre class="highlight"><code class="language-wrapped-shell-error">2023-03-20 12:28:26.293:INFO:oejshC.web_app_spring:qtp2101842856-13: No JSP support.  Check that JSP jars are in lib/jsp and that the JSP option has been specified to start.jar</code></pre>
</div>
<blockquote>
<p>Git commit: <code>a48ebdb4100ae75236cc2165d4e50b417d1a48a5</code> specifying direct view file location</p>
</blockquote>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="using-view-resolver">Using view resolver</h1>
<p>[<a href="../references.html#ref_1_8">1.8</a>, <a href="https://youtu.be/5_G1jIiK2hI?t=1118">18:38</a>]</p>
<p>The main idea may be described like this: we have a view file location, e.g. <code>/view/helloView.jsp</code>,
but the controller method returns just an internal part of this location or a <em>base name</em>,
like <code>helloView</code>.</p>
<p><img alt="" src="../../pict/view_resolver.png" /></p>
<p>The <em>view resolver</em> prepends and appends the <em>base name</em> with the <strong>prefix</strong> and the <strong>suffix</strong>
and returns the full view location.</p>
<p>In Spring MVC the view resolver class is 
<code>org.springframework.web.servlet.view.InternalResourceViewResolver</code>.</p>
<p>So in the dispatcher servlet configuration file <a href="../../../projects/web-app-spring/src/main/webapp/WEB-INF/front-controller-servlet.xml"><code>front-controller-servlet.xml</code></a>
we add the following bean:</p>
<pre class="highlight"><code class="language-xml">    .  .  .
    &lt;bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"&gt;
        &lt;property name="prefix" value="/view/"/&gt;
        &lt;property name="suffix" value=".jsp"/&gt;
    &lt;/bean&gt;
    .  .  .</code></pre>
<p>And in the controller <a href="../../../projects/web-app-spring/src/main/java/springmvcstudy/controllers/JspHelloController.java"><code>JspHelloController</code></a>
we change the return value from <code>/view/jspHello.jsp</code> to <code>jspHello</code>:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @RequestMapping("/hello")
    public String getJspHello() {
        return "jspHello";
    }
    .  .  .</code></pre>
<p>After that, navigating to <a href="http://localhost:8080/web-app-spring/jsp/hello">http://localhost:8080/web-app-spring/jsp/hello</a> gives the same result.</p>
<p>But now if the view directory changes it will require readjustment in only one place.</p>
<blockquote>
<p>Git commit: <code>d33bc3c9d1ee706a12b84acf3332e9c899325c59</code> view resolver introduced</p>
</blockquote>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="web_application_context.html" 
title="Previous: Web application context"><img src="../../layout/pict/previous_page.png"/></a>

<a href="model.html" title="Next: Model"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
