<!DOCTYPE html>
<html>
<head><title>Server setup</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>
<link rel="stylesheet" type="text/css" href="../../theme.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web<span class="localOnly" title="Unrestricted">*</span></span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a>

<a href="../../../doc_src/content/beginner/server_setup.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="about_part_1.html" title="Previous: About this part"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="front_controller.html" title="Next: Front controller"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Server setup</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item"><a href="../../../readme.html">About the course</a></div>
<div class="sidebar_item"><a href="../references.html">References</a></div>
<div class="sidebar_item"><a href="../common_notes.html">Common notes</a></div>
            <h3>Beginner</h3>
            <div class="sidebar_item"><a href="about_part_1.html">About this part</a></div>
<div class="sidebar_item selected"><a href="server_setup.html">Server setup</a></div>
<div class="sidebar_item"><a href="front_controller.html">Front controller</a></div>
<div class="sidebar_item"><a href="spring_web_app_setup.html">Spring web application setup</a></div>
<div class="sidebar_item"><a href="web_application_context.html">Web application context</a></div>
<div class="sidebar_item"><a href="view_resolver.html">View resolver</a></div>
<div class="sidebar_item"><a href="model.html">Model</a></div>
            <h3>Intermediate</h3>
            <div class="sidebar_item"><a href="../intermediate/about_part_2.html">About this part</a></div>
<div class="sidebar_item"><a href="../intermediate/get_rid_of_web_xml.html">Get rid of XML configuration</a></div>
<div class="sidebar_item"><a href="../intermediate/data_binding.html">Data binding</a></div>
<div class="sidebar_item"><a href="../intermediate/registration_form.html">Registration form</a></div>
<div class="sidebar_item"><a href="../intermediate/form_validation.html">Form validation</a></div>
<div class="sidebar_item"><a href="../intermediate/formatters.html">Spring MVC Formatter</a></div>
<div class="sidebar_item"><a href="../intermediate/send_email.html">Send email</a></div>
<div class="sidebar_item"><a href="../intermediate/sessions_and_cookies.html">Sessions and cookies</a></div>
<div class="sidebar_item"><a href="../intermediate/service_layer.html">Service layer</a></div>
<div class="sidebar_item"><a href="../intermediate/exception_handling.html">Exception handling</a></div>
            <h3>Sidesteps</h3>            
            <div class="sidebar_item"><a href="../sidesteps/sidesteps.html">Sidesteps</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Server setup</p>

<div class="toc">
<ul>
<li><a href="#about-this-section">About this section</a></li>
<li><a href="#install-and-setup-jetty-server">Install and setup Jetty server</a></li>
<li><a href="#initialize-maven-project">Initialize Maven project</a></li>
<li><a href="#serving-static-content">Serving static content</a></li>
</ul>
</div>
<hr />
<h1 id="about-this-section">About this section</h1>
<p>This section describes simple Jetty server installation and setup. Small useless application
is going to be created and run for a sanity check.</p>
<hr />
<h1 id="install-and-setup-jetty-server">Install and setup Jetty server</h1>
<p>Home page: <a href="https://www.eclipse.org/jetty/">https://www.eclipse.org/jetty/</a>  <br />
Downloads: <a href="https://www.eclipse.org/jetty/download.php">https://www.eclipse.org/jetty/download.php</a>  <br />
Checksums: <a href="https://www.eclipse.org/jetty/download_info.php">https://www.eclipse.org/jetty/download_info.php</a></p>
<p>Version 9.4.51.v20230217 is used. Following the instructions [<a href="../references.html#ref_4">4</a>, <a href="https://www.eclipse.org/jetty/documentation/jetty-9/index.html#quickstart-running-jetty">Running Jetty</a>]:</p>
<ol>
<li>Unzip the distribution pack to the directory by choice, e.g. 
    <code>jetty-distribution-9.4.51.v20230217.zip/jetty-distribution-9.4.51.v20230217</code> to <code>jetty_9_4_51</code>.</li>
<li>Create the <code>JETTY_HOME</code> environment variable that points the <code>jetty_9_4_51</code> directory.</li>
<li>Create the <code>JETTY_BASE</code> environment variable that points the directory where the applications
    will be located.</li>
</ol>
<p>Execute the following commands to initialize the Jetty base directory:</p>
<pre class="highlight"><code class="language-wrapped-shell">&gt;cd /d %JETTY_BASE%

&gt;java -jar %JETTY_HOME%\start.jar --create-startd
MKDIR : ${jetty.base}\start.d
INFO  : Base directory was modified

&gt;java -jar %JETTY_HOME%\start.jar --add-to-start=http,deploy
INFO  : webapp          transitively enabled, ini template available with --add-to-start=webapp
.  .  .
MKDIR : ${jetty.base}\webapps
INFO  : Base directory was modified

&gt;java -jar %JETTY_HOME%\start.jar
2023-03-18 11:36:14.115:INFO::main: Logging initialized @439ms to org.eclipse.jetty.util.log.StdErrLog
.  .  .
2023-03-18 11:36:14.306:INFO:oejs.AbstractConnector:main: Started ServerConnector@cd2dae5{HTTP/1.1, (http/1.1)}{0.0.0.0:8080}
2023-03-18 11:36:14.306:INFO:oejs.Server:main: Started @630ms</code></pre>
<p>In a browser navigate to <a href="http://localhost:8080/">http://localhost:8080/</a> to see an "Error 404 - Not Found" page. To stop
the server press <code>Ctrl</code>+<code>C</code>.</p>
<p><a name="activate_jetty_jsp_module"></a>
As we are going to use JSP, adding the <code>jsp</code> module, also see the Jetty documentation [<a href="../references.html#ref_4">4</a>]:</p>
<ul>
<li><a href="https://www.eclipse.org/jetty/documentation/jetty-9/index.html#configuring-jsp">Configuring JSP Support</a></li>
<li><a href="https://www.eclipse.org/jetty/documentation/jetty-9/index.html#startup-modules">Managing Startup Modules</a></li>
</ul>
<pre class="highlight"><code class="language-shell">&gt;java -jar %JETTY_HOME%\start.jar --add-to-start=jsp
INFO  : mail            transitively enabled
INFO  : apache-jsp      transitively enabled
INFO  : jsp             initialized in ${jetty.base}\start.d\jsp.ini
INFO  : jndi            transitively enabled
INFO  : annotations     transitively enabled
INFO  : transactions    transitively enabled
INFO  : plus            transitively enabled
INFO  : Base directory was modified</code></pre>
<hr />
<p><a name="initialize_web_maven_project"></a></p>
<h1 id="initialize-maven-project">Initialize Maven project</h1>
<pre class="highlight"><code class="language-wrapped-shell">&gt;mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4 -DgroupId=world.someone -DartifactId=web-app-jetty -DinteractiveMode=false</code></pre>
<p>For more details about <em>Maven Webapp Archetype</em> see:</p>
<ul>
<li>The official documentation
    <a href="https://maven.apache.org/archetypes/maven-archetype-webapp/">Maven Webapp Archetype</a></li>
<li>The command <code>mvn archetype:help -Dgoal=generate -Ddetail=true</code></li>
<li><a href="https://mvnrepository.com/artifact/org.apache.maven.archetypes/maven-archetype-webapp">Maven Webapp Archetype</a>
    artifact</li>
</ul>
<p>After some reformatting and deleting unnecessary things the <code>pom.xml</code> file looks like the following:</p>
<pre class="highlight"><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0
          http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;world.someone&lt;/groupId&gt;
    &lt;artifactId&gt;web-app-jetty&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;packaging&gt;war&lt;/packaging&gt;

    &lt;properties&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;maven.compiler.source&gt;8&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;8&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    &lt;build&gt;
        &lt;finalName&gt;${project.artifactId}&lt;/finalName&gt;
        &lt;directory&gt;${TMP_MAVEN_BUILDS_DIR}${project.artifactId}&lt;/directory&gt;
    &lt;/build&gt;
&lt;/project&gt;
</code></pre>
<p>The <code>build/finalName</code> element is added to avoid the version in the artifact war-file name.</p>
<p>The <code>build/directory</code> element is added to bring the generated artifacts out of the working project
directory. This will significantly reduce a possible backup size. The environment variable 
<code>TMP_MAVEN_BUILDS_DIR</code> must be defined in the system. Such solution should hardly be applied 
in real projects.</p>
<p>The deployment descriptor look like this:</p>
<pre class="highlight"><code class="language-xml">&lt;!DOCTYPE web-app PUBLIC
        "-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN"
        "http://java.sun.com/dtd/web-app_2_3.dtd"&gt;

&lt;web-app&gt;
    &lt;display-name&gt;JSP Example Application&lt;/display-name&gt;
&lt;/web-app&gt;</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The current <code>DOCTYPE</code> declaration though being old-fashioned still works. There are 
controversial information on the Internet  about the proper schemata declarations, and also
IntelliJ IDEA complains with "element 'web-app' must be declared" when newer declarations
are used. Looks like it takes too much time to find the way of avoiding it.</p>
<p>A newer style <code>web.xml</code> may be generated in Eclipse: File &mdash; New &mdash; Dynamic project, 
then at some later step don't forget to check the "Generate web.xml deployment descriptor"
checkbox. But this <code>web.xml</code> still causes validation complaints in IntelliJ IDEA.</p>
</div>
<p>The sample <code>index.jsp</code> file was edited to demonstrate that the specific JSP syntax works 
(also see [<a href="../references.html#ref_3">3</a>]):</p>
<pre class="highlight"><code class="language-xml">&lt;html&gt;&lt;body&gt;
&lt;h2&gt;Hello World!&lt;/h2&gt;
&lt;p&gt;Counting to three:
&lt;% for (int i=1; i&lt;4; i++) { %&gt;
    &lt;%= i %&gt;,
&lt;% } %&gt;
OK.&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;</code></pre>
<p>This simple setup looks like being enough for running in Jetty server. Just need to build the
artifact:</p>
<pre class="highlight"><code class="language-shell">&gt;cd web-app-jetty

&gt;mvn clean package</code></pre>
<p><a name="project_start_on_server"></a>
Copy the file <code>web-app-jetty.war</code> from the current target directory into the <code>%JETTY_BASE%/webapps</code>
directory. Make sure that the Jetty <code>jsp</code> is activated 
(see <a href="server_setup.html#activate_jetty_jsp_module">here</a>).
Stop the Jetty server by pressing <code>Ctrl</code>+<code>C</code>, if it's running, and start it again:</p>
<pre class="highlight"><code class="language-shell">&gt;java -jar %JETTY_HOME%\start.jar</code></pre>
<p>Navigate to <a href="http://localhost:8080/web-app-jetty/">http://localhost:8080/web-app-jetty/</a> to see the result:</p>
<p><img alt="" src="../../pict/hello_world.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Actually it's not necessary to restart the server. Just copying the file <code>web-app-jetty.war</code>
to the <code>webapps</code> directory may be enough. The Jetty server will automatically detect this 
replacement and reload the application in about 5 sec.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/429b1fd4f65f6182962255078e0d32bd02949b50.html"><code>429b1fd4f65f6182962255078e0d32bd02949b50</code></a>
simplest web app run in Jetty  <br />
Git commit: <a href="../patches/31a1cc7364bc8d81cbba2230eedd929714ddd8a0.html"><code>31a1cc7364bc8d81cbba2230eedd929714ddd8a0</code></a>
Maven target directories redefined</p>
</blockquote>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="serving-static-content">Serving static content</h1>
<p>Serving static content from inside the WAR files was discussed in the StackOverflow question 
<a href="https://stackoverflow.com/questions/75790960/serve-html-files-from-inside-war-file-with-jetty-server-and-spring-mvc">Serve HTML files from inside WAR file with Jetty server and Spring MVC</a>.</p>
<p>The suggestion was to follow the instructions at [<a href="../references.html#ref_6">6</a>, <a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/web.html#mvc-config-static-resources">1.11.10. Static Resources</a>], 
particularly adding the following definitions into the servlet dispatcher XML configuration file
<a href="../../../projects/web-app-spring/src/main/webapp/WEB-INF/front-controller-servlet.xml"><code>front-controller-servlet.xml</code></a>:</p>
<pre class="highlight"><code class="language-xml">    .  .  .
    &lt;mvc:resources mapping="/html/**" location="/static/"/&gt;
    &lt;mvc:default-servlet-handler/&gt;
    .  .  .</code></pre>
<p><a name="index_entry_index_2"></a>
The <code>mvc</code> namespace should be declared the following way:</p>
<pre class="highlight"><code class="language-xml">&lt;beans 
       .  .  .
       xmlns:mvc="http://www.springframework.org/schema/mvc"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
        .  .  .
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        .  .  .
        "&gt;
.  .  .</code></pre>
<p>So the URL <a href="http://localhost:8080/web-app-spring/html/static.html">http://localhost:8080/web-app-spring/html/static.html</a> returns the page
<code>src/main/webapp/static/static.html</code>.</p>
<p>For more details and examples see [<a href="../references.html#ref_7_1">7.1</a>] and [<a href="../references.html#ref_7_2">7.2</a>].</p>
<blockquote>
<p>Git commit: <a href="../patches/51b4238098206ff2e119614a2909db12355a206f.html"><code>51b4238098206ff2e119614a2909db12355a206f</code></a>
serving static content added</p>
</blockquote>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="about_part_1.html" 
title="Previous: About this part"><img src="../../layout/pict/previous_page.png"/></a>

<a href="front_controller.html" title="Next: Front controller"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>


</body>
</html>
