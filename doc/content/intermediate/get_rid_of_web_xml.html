<!DOCTYPE html>
<html>
<head><title>Get rid of XML configuration</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>
<link rel="stylesheet" type="text/css" href="../../theme.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web</span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a>

<a href="../../../doc_src/content/intermediate/get_rid_of_web_xml.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="about_part_2.html" title="Previous: About this part"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="data_binding.html" title="Next: Data binding"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Get rid of XML configuration</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item"><a href="../../../readme.html">About the course</a></div>
<div class="sidebar_item"><a href="../references.html">References</a></div>
<div class="sidebar_item"><a href="../common_notes.html">Common notes</a></div>
            <h3>Beginner</h3>
            <div class="sidebar_item"><a href="../beginner/about_part_1.html">About this part</a></div>
<div class="sidebar_item"><a href="../beginner/server_setup.html">Server setup</a></div>
<div class="sidebar_item"><a href="../beginner/front_controller.html">Front controller</a></div>
<div class="sidebar_item"><a href="../beginner/spring_web_app_setup.html">Spring web application setup</a></div>
<div class="sidebar_item"><a href="../beginner/web_application_context.html">Web application context</a></div>
<div class="sidebar_item"><a href="../beginner/view_resolver.html">View resolver</a></div>
<div class="sidebar_item"><a href="../beginner/model.html">Model</a></div>
            <h3>Intermediate</h3>
            <div class="sidebar_item"><a href="about_part_2.html">About this part</a></div>
<div class="sidebar_item selected"><a href="get_rid_of_web_xml.html">Get rid of XML configuration</a></div>
<div class="sidebar_item"><a href="data_binding.html">Data binding</a></div>
<div class="sidebar_item"><a href="registration_form.html">Registration form</a></div>
<div class="sidebar_item"><a href="form_validation.html">Form validation</a></div>
<div class="sidebar_item"><a href="formatters.html">Spring MVC Formatter</a></div>
<div class="sidebar_item"><a href="send_email.html">Send email</a></div>
<div class="sidebar_item"><a href="sessions_and_cookies.html">Sessions and cookies</a></div>
<div class="sidebar_item"><a href="service_layer.html">Service layer</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Get rid of XML configuration</p>

<div class="toc">
<ul>
<li><a href="#project-setup">Project setup</a></li>
<li><a href="#introduce-webapplicationinitializer">Introduce WebApplicationInitializer</a></li>
<li><a href="#adjust-dispatcher-servlet">Adjust dispatcher servlet</a></li>
<li><a href="#get-rid-of-spring-config-xml-file">Get rid of Spring config XML file</a></li>
<li><a href="#create-a-view">Create a view</a></li>
<li><a href="#quicker-web-application-initializer">Quicker web application initializer</a></li>
<li><a href="#several-initializers">Several initializers</a></li>
</ul>
</div>
<hr />
<p>Mar 22, 2023</p>
<h1 id="project-setup">Project setup</h1>
<p>[<a href="../references.html#ref_2_4">2.4</a>, <a href="https://youtu.be/Hk7fRv-GHpM?t=53">0:53</a>]</p>
<p>The complete instructions may be found 
<a href="../beginner/server_setup.html#initialize_web_maven_project">here</a>.
The following is the particular customized command:</p>
<pre class="highlight"><code class="language-wrapped-shell">&gt;mvn archetype:generate -DarchetypeGroupId=org.apache.maven.archetypes -DarchetypeArtifactId=maven-archetype-webapp -DarchetypeVersion=1.4 -DgroupId=world.someone -DartifactId=web-app-spring-adv1 -DinteractiveMode=false</code></pre>
<p>Some simple cleaning and reformatting is done. After building and deploying the application 
the request to <a href="http://localhost:8080/web-app-spring-adv1/">http://localhost:8080/web-app-spring-adv1/</a> returns our desired hello page.</p>
<blockquote>
<p>Git commit: <a href="../patches/51fce12a2a4326e07a0832e6ac1a215dda4117f4.html"><code>51fce12a2a4326e07a0832e6ac1a215dda4117f4</code></a>
first advanced web application initialized</p>
</blockquote>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="introduce-webapplicationinitializer">Introduce <code>WebApplicationInitializer</code></h1>
<p>In this section we are going to get rid of the <code>web.xml</code> file. But as this file is a key element
of a web application, we need to replace it with something that will take up these functions.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>There's a quicker way of a dispatcher servlet initialization described
<a href="get_rid_of_web_xml.html#quicker_web_application_initializer">here</a>.</p>
</div>
<p>The Servlet standard of versions 3.0 and later defines this mechanism by detecting the
implementations of the <code>WebApplicationInitializer</code> interface. This interface has a method 
<code>public void onStartup(ServletContext servletContext)</code> that is called on the web application
initialization. This method allows defining and setting a dispatcher servlet into the 
provided <code>ServletContext</code> instance.</p>
<p>For more details see:</p>
<ul>
<li>The Spring MVC documentation [<a href="../references.html#ref_6">6</a>, <a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/web.html#mvc-servlet">1.1. DispatcherServlet</a>, and 
    <a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/web.html#mvc-container-config">1.1.4. Servlet Config</a>]</li>
<li>The Javadocs of classes: <a href="https://tomcat.apache.org/tomcat-8.0-doc/servletapi/javax/servlet/ServletContext.html"><code>javax.servlet.ServletContext</code></a> and
    <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/WebApplicationInitializer.html"><code>org.springframework.web.WebApplicationInitializer</code></a></li>
</ul>
<p>[<a href="../references.html#ref_2_4">2.4</a>, <a href="https://youtu.be/Hk7fRv-GHpM?t=251">4:11</a>]</p>
<p>If we just delete the <code>web.xml</code> file, the Maven build will complain:</p>
<pre class="highlight"><code class="language-wrapped-shell-error">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-war-plugin:2.2:war (default-war) on project web-app-spring-adv1: Error assembling WAR: webxml attribute is required (or pre-existing WEB-INF/web.xml if executing in update mode)</code></pre>
<p>The following steps are going to be done to fix this:</p>
<ul>
<li>
<p>Add the Spring MVC dependency:</p>
<pre class="highlight"><code class="language-xml">    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
        &lt;version&gt;${org.springframework.version}&lt;/version&gt;
    &lt;/dependency&gt;</code></pre>
<p>The version is <code>5.3.9</code> as for now. Also see the complete
<a href="../../../projects/web-app-spring-adv1/pom.xml"><code>pom.xml</code></a> file.</p>
</li>
<li>
<p>Create the web application initializer class <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyApplicationInitializer.java"><code>MyApplicationInitializer</code></a>
    that implements the <code>org.springframework.web.WebApplicationInitializer</code> interface.
    For the first simple attempt we just log the fact of calling the <code>onStartup</code> method.</p>
</li>
<li>
<p>In order to implement the <code>WebApplicationInitializer</code> class we need to add the Servlet API 
    dependency:</p>
<pre class="highlight"><code class="language-xml">    &lt;dependency&gt;
        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
        &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
        &lt;version&gt;4.0.1&lt;/version&gt;
        &lt;scope&gt;provided&lt;/scope&gt;
    &lt;/dependency&gt;</code></pre>
</li>
<li>
<p><a name="index_entry_index_2"></a>In order to avoid the "webxml attribute is required" error
    (see above) we need to add the corresponding configuration into our <code>maven-war-plugin</code>
    definition:</p>
<pre class="highlight"><code class="language-xml">        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.3.2&lt;/version&gt;
            &lt;configuration&gt;
                &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Also the <code>failOnMissingWebXml</code> parameter may be specified in the POM's <code>properties</code>
section just the same way it's done in the plugin definition.</p>
</div>
</li>
</ul>
<p>After building, deploying and running our application in the Jetty server we see the following 
in the server log:</p>
<pre class="highlight"><code class="language-wrapped-shell">2023-03-22 16:45:14.894:INFO:oejshC.web_app_spring_adv1:main: 1 Spring WebApplicationInitializers detected on classpath
WebApplicationInitializer introduced!</code></pre>
<p>[<a href="../references.html#ref_2_4">2.4</a>, <a href="https://youtu.be/Hk7fRv-GHpM?t=876">14:36</a>]</p>
<p>So as we can see the <code>MyApplicationInitializer</code> class was successfully detected and called. 
The URL <a href="http://localhost:8080/web-app-spring-adv1/">http://localhost:8080/web-app-spring-adv1/</a> returns the same hello page.</p>
<blockquote>
<p>Git commit: <a href="../patches/64f362440b71925364539571eb69e54b1d4a68b4.html"><code>64f362440b71925364539571eb69e54b1d4a68b4</code></a>
MyApplicationInitializer introduced</p>
</blockquote>
<hr />
<h1 id="adjust-dispatcher-servlet">Adjust dispatcher servlet</h1>
<p>The dispatcher servlet is created and adjusted the following way (the class is 
<a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyApplicationInitializer.java"><code>MyApplicationInitializer</code></a>):</p>
<pre class="highlight"><code class="language-code">public class MyApplicationInitializer implements WebApplicationInitializer {

    @Override
    public void onStartup(ServletContext servletContext) throws ServletException {

        XmlWebApplicationContext webApplicationContext = new XmlWebApplicationContext();
        webApplicationContext.setConfigLocation("classpath:application-config.xml");

        DispatcherServlet dispatcherServlet = new DispatcherServlet(webApplicationContext);

        ServletRegistration.Dynamic registration =
                servletContext.addServlet("front-controller", dispatcherServlet);

        registration.setLoadOnStartup(1);
        registration.addMapping("/ui/*");
    }
}</code></pre>
<p>So by now we've reproduced all the configuration we did with the <code>web.xml</code> file.</p>
<p>On application start the following output is shown in the console:</p>
<pre class="highlight"><code class="language-wrapped-shell">.  .  .
2023-03-22 19:18:23.786:INFO:oejshC.web_app_spring_adv1:main: Initializing Spring DispatcherServlet 'front-controller'
Mar 22, 2023 7:18:23 PM org.springframework.web.servlet.FrameworkServlet initServletBean
INFO: Initializing Servlet 'front-controller'
Mar 22, 2023 7:18:24 PM org.springframework.web.servlet.FrameworkServlet initServletBean
INFO: Completed initialization in 295 ms
.  .  .</code></pre>
<p>For now we still use an XML dispatcher servlet configuration file, but we we are going to get rid
of it soon.</p>
<p>Now need to add a simple controller (<a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/controllers/HelloController.java"><code>HelloController</code></a>)
to check it works. After that the URL <a href="http://localhost:8080/web-app-spring-adv1/ui/hello">http://localhost:8080/web-app-spring-adv1/ui/hello</a>
returns a page with content "Hi from the HelloController" (as it did in the previous part).</p>
<blockquote>
<p>Got commit: <code>ba89f0258f2042feae87b3b39422a9d40f664e91</code> dispatcher servlet and controller adjusted</p>
</blockquote>
<hr />
<h1 id="get-rid-of-spring-config-xml-file">Get rid of Spring config XML file</h1>
<p>[<a href="../references.html#ref_2_4">2.4</a>, <a href="https://youtu.be/Hk7fRv-GHpM?t=2166">36:06</a>]</p>
<p>New code-based configuration file <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyApplicationConfig.java"><code>MyApplicationConfig</code></a>
was created:</p>
<pre class="highlight"><code class="language-code">@Configuration
@ComponentScan(basePackages = "springmvcstudy2.controllers")
public class MyApplicationConfig {
}</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Although this configuration class is working for now, in the future the <code>@EnableWebMvc</code>
will be required, so it's a good idea to add it now.</p>
</div>
<p>Than the above configuration class is used for initializing the dispatcher servlet web application
context (in the <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyApplicationInitializer.java"><code>MyApplicationInitializer</code></a>
file):</p>
<pre class="highlight"><code class="language-code">        .  .  .
        AnnotationConfigWebApplicationContext webApplicationContext =
                new AnnotationConfigWebApplicationContext();
        webApplicationContext.register(MyApplicationConfig.class);
        .  .  .</code></pre>
<p>The dispatcher servlet web application context XML file 
<code>/src/main/resources/application-config.xml</code> is deleted as it's not needed anymore.</p>
<blockquote>
<p>Git commit: <a href="../patches/1a79873d1890deede7fe5da2b564acdf5bec7e6c.html"><code>1a79873d1890deede7fe5da2b564acdf5bec7e6c</code></a>
Spring XML configuration eliminated</p>
</blockquote>
<hr />
<h1 id="create-a-view">Create a view</h1>
<p>[<a href="../references.html#ref_2_4">2.4</a>, <a href="https://youtu.be/Hk7fRv-GHpM?t=2630">43:50</a>]</p>
<p>In this section we create a view and tie it up with a controller and a view resolver.</p>
<p>The view is <a href="../../../projects/web-app-spring-adv1/src/main/webapp/view/hello-page.jsp"><code>hello-page.jsp</code></a> that is pretty much 
similar to the ones that were created in the beginner part.</p>
<p>The controller method is added in the <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/controllers/HelloController.java"><code>HelloController</code></a>
class:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @RequestMapping("/hello-jsp")
    public String helloJsp() {
        return "hello-page";
    }
    .  .  .</code></pre>
<p><a name="index_entry_index_3"></a>
The view resolver is added as a bean into the <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyApplicationConfig.java"><code>MyApplicationConfig</code></a>
class:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @Bean
    public InternalResourceViewResolver viewResolver() {
        InternalResourceViewResolver viewResolver = new InternalResourceViewResolver();
        viewResolver.setPrefix("/view/");
        viewResolver.setSuffix(".jsp");
        return viewResolver;
    }
    .  .  .</code></pre>
<p>The URL <a href="http://localhost:8080/web-app-spring-adv1/ui/hello-jsp">http://localhost:8080/web-app-spring-adv1/ui/hello-jsp</a> is now returning the JSP hello
page:</p>
<p><img alt="" src="../../pict/hello_from_code_based.png" /></p>
<blockquote>
<p>Git commit: <a href="../patches/bceed41baece547af98f5bf88dbac27d133834d6.html"><code>bceed41baece547af98f5bf88dbac27d133834d6</code></a>
view created</p>
</blockquote>
<hr />
<p><a name="index_entry_index_4"></a><a 
name="quicker_web_application_initializer"></a></p>
<h1 id="quicker-web-application-initializer">Quicker web application initializer</h1>
<p>[<a href="../references.html#ref_2_5">2.5</a>], also see [<a href="../references.html#ref_6">6</a>, <a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/web.html#mvc-container-config">1.1.4. Servlet Config</a>]</p>
<p>A web application initializer may extend the 
<code>org.springframework.web.servlet.support.AbstractAnnotationConfigDispatcherServletInitializer</code>
class instead of implementing the <code>org.springframework.web.WebApplicationInitializer</code>
interface. This let define configuration in a more declarative way when Spring MVC framework
takes up all responsibilities for doing actual initialization work.</p>
<p>In our application we are creating another initializer <a href="../../../projects/web-app-spring-adv1/src/main/java/springmvcstudy2/config/MyQuickApplicationInitializer.java"><code>MyQuickApplicationInitializer</code></a>:</p>
<pre class="highlight"><code class="language-code">public class MyQuickApplicationInitializer extends
        AbstractAnnotationConfigDispatcherServletInitializer {

    @Override
    protected Class&lt;?&gt;[] getRootConfigClasses() {
        return null;
    }

    @Override
    protected Class&lt;?&gt;[] getServletConfigClasses() {
        return new Class&lt;?&gt;[]{MyApplicationConfig.class};
    }

    @Override
    protected String[] getServletMappings() {
        return new String[]{"/ui/*"};
    }
}</code></pre>
<p>The existing one (<code>MyApplicationInitializer</code>) is disabled by removing its <code>implements</code> clause.
On the server start the following output shows that the default dispatcher servlet name is 
<code>dispatcher</code>:</p>
<pre class="highlight"><code class="language-wrapped-shell">2023-03-23 00:04:33.085:INFO:oejshC.web_app_spring_adv1:Scanner-0: 1 Spring WebApplicationInitializers detected on classpath
2023-03-23 00:04:33.133:INFO:oejshC.web_app_spring_adv1:Scanner-0: Initializing Spring DispatcherServlet 'dispatcher'
Mar 23, 2023 12:04:33 AM org.springframework.web.servlet.FrameworkServlet initServletBean
INFO: Initializing Servlet 'dispatcher'
Mar 23, 2023 12:04:33 AM org.springframework.web.servlet.FrameworkServlet initServletBean
INFO: Completed initialization in 585 ms</code></pre>
<p>The application works the same way.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>AbstractAnnotationConfigDispatcherServletInitializer</code> implements the
<code>WebApplicationInitializer</code> interface.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/bb292b53cf714cf728d9491022d9f40ceab83e57.html"><code>bb292b53cf714cf728d9491022d9f40ceab83e57</code></a>
quicker dispatcher servlet initializer used</p>
</blockquote>
<hr />
<p><a name="index_entry_index_5"></a></p>
<h1 id="several-initializers">Several initializers</h1>
<p>Several implementations of the <code>WebApplicationInitializer</code> interface may exist in the class path
and all of them will be detected and used by the server. The 
<code>@org.springframework.core.annotation.Order</code> annotation may be used to define the initialization
order.</p>
<p>The experiment was done that proved that the lower value the <code>@Order</code> annotation has the earlier 
initialization is fulfilled.</p>
<p>The initializers overwriting details were not investigated.</p>
<blockquote>
<p>Git commit: <a href="../patches/015781551dda2c8d1c293a4d53168d26789c94ba.html"><code>015781551dda2c8d1c293a4d53168d26789c94ba</code></a>
several initializers investigation</p>
</blockquote>
<p>In the end the first initialized is reverted:</p>
<blockquote>
<p>Git commit: <a href="../patches/f72bf85b802ad02c85c341d0df5db40f71668922.html"><code>f72bf85b802ad02c85c341d0df5db40f71668922</code></a>
the first initializer is reverted</p>
</blockquote>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="about_part_2.html" 
title="Previous: About this part"><img src="../../layout/pict/previous_page.png"/></a>

<a href="data_binding.html" title="Next: Data binding"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
