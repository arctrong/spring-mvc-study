<!DOCTYPE html>
<html>
<head><title>Sessions and cookies</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>

<link rel="stylesheet" type="text/css" href="../../theme.css"/>
<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web<span class="localOnly" title="Unrestricted">*</span></span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a><a 
class="header_item" href="https://github.com/arctrong/spring-mvc-study">GitHub</a>

<a href="../../../doc_src/content/intermediate/sessions_and_cookies.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="send_email.html" title="Previous: Send email"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="service_layer.html" title="Next: Service layer"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Sessions and cookies</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            
            <a href="../../../readme.html" class="sidebar_item">About the course</a>
<a href="../references.html" class="sidebar_item">References</a>
<a href="../common_notes.html" class="sidebar_item">Common notes</a>
            <h3>Beginner</h3>
            <a href="../beginner/about_part_1.html" class="sidebar_item">About this part</a>
<a href="../beginner/server_setup.html" class="sidebar_item">Server setup</a>
<a href="../beginner/front_controller.html" class="sidebar_item">Front controller</a>
<a href="../beginner/spring_web_app_setup.html" class="sidebar_item">Spring web application setup</a>
<a href="../beginner/web_application_context.html" class="sidebar_item">Web application context</a>
<a href="../beginner/view_resolver.html" class="sidebar_item">View resolver</a>
<a href="../beginner/model.html" class="sidebar_item">Model</a>
            <h3>Intermediate</h3>
            <a href="about_part_2.html" class="sidebar_item">About this part</a>
<a href="get_rid_of_web_xml.html" class="sidebar_item">Get rid of XML configuration</a>
<a href="data_binding.html" class="sidebar_item">Data binding</a>
<a href="registration_form.html" class="sidebar_item">Registration form</a>
<a href="form_validation.html" class="sidebar_item">Form validation</a>
<a href="formatters.html" class="sidebar_item">Spring MVC Formatter</a>
<a href="send_email.html" class="sidebar_item">Send email</a>
<a href="sessions_and_cookies.html" class="sidebar_item selected">Sessions and cookies</a>
<a href="service_layer.html" class="sidebar_item">Service layer</a>
<a href="exception_handling.html" class="sidebar_item">Exception handling</a>
            <h3>Sidesteps</h3>
            <a href="../sidesteps/sidesteps.html" class="sidebar_item">Sidesteps</a>
<a href="../sidesteps/jetty_server_notes.html" class="sidebar_item">Jetty server notes</a>
<a href="../sidesteps/embedded_server.html" class="sidebar_item">Embedded server</a>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.3
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Sessions and cookies</p>

<div class="toc">
<ul>
<li><a href="#what-is-session-and-cookies">What is session and cookies</a></li>
<li><a href="#implement-cookies-transfer">Implement cookies transfer</a></li>
<li><a href="#managing-cookies-using-spring">Managing cookies using Spring</a></li>
<li><a href="#using-sessions">Using sessions</a></li>
<li><a href="#session-timeout">Session timeout</a></li>
<li><a href="#using-sessionattributes-annotation">Using @SessionAttributes annotation</a></li>
<li><a href="#conversational-scope">Conversational scope</a><ul>
<li><a href="#request-scope">Request scope</a></li>
<li><a href="#adding-conversational-scope">Adding conversational scope</a></li>
<li><a href="#specify-scope-explicitly-in-jsp-page">Specify scope explicitly in JSP page</a></li>
<li><a href="#get-things-simpler">Get things simpler</a></li>
<li><a href="#completing-the-conversation">Completing the conversation</a></li>
<li><a href="#restrictions-on-sessionattributes-annotation">Restrictions on @SessionAttributes annotation</a></li>
<li><a href="#httpsession-vs-sessionattribute">HttpSession vs @SessionAttribute</a></li>
<li><a href="#clearing-up-the-httpsession-session">Clearing up the HttpSession session</a></li>
</ul>
</li>
<li><a href="#cookies-url-encoding">Cookies URL encoding</a></li>
</ul>
</div>
<hr />
<p>Mar 30, 2023</p>
<p><a name="index_entry_index_1"></a></p>
<h1 id="what-is-session-and-cookies">What is session and cookies</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>]</p>
<p>HTTP is a stateless protocol so it doesn't save information between the requests. <strong>Cookies</strong>
were invented in maybe 1995 to fill this gap.</p>
<p>Also see [<a href="../references.html#ref_16">16</a>].</p>
<hr />
<h1 id="implement-cookies-transfer">Implement cookies transfer</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=743">12:23</a>]</p>
<p>This is the first simple implementation that is probably not to be used in production.</p>
<blockquote>
<p>Git commit: <a href="../patches/24df68c254b3e3173d927e87505a419c41997009.html"><code>24df68c254b3e3173d927e87505a419c41997009</code></a>
first simple cookie usage demonstrated</p>
</blockquote>
<p>In the <code>/validate-submit</code> endpoint we create a <code>Cookie</code> and add it to the <code>HttpServletResponse</code>
object that is provided by Spring MVC via the corresponding controller method parameter 
<code>response</code>. After the response is received the added cookie may be viewed in the debugger (F12):</p>
<p><img alt="" src="../../pict/debug_cookies.png" /></p>
<p>The added cookie is sent by the browser with every subsequent request so it can be used on every
page like the one that is returned by the <code>/validate</code> endpoint.</p>
<hr />
<p><a name="index_entry_index_2"></a></p>
<h1 id="managing-cookies-using-spring">Managing cookies using Spring</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=2248">37:28</a>]</p>
<p>The above method is much inconvenient especially when used in a lot of controllers. The Spring 
<code>@CookieValue</code> annotation may help simplify this task (see the <a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/EmailController.java"><code>EmailController</code></a>
class):</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/sendEmail")
    public String sendEmail(@CookieValue("myApp.userName") String userName, Model model) {
        model.addAttribute("sendEmailDto", new SendEmailDto());
        model.addAttribute("userName", userName);
        return "send-email-page";
    }</code></pre>
<blockquote>
<p>Git commit: <a href="../patches/c24fc1711dc1fcf02609152e8135f838b886fdd6.html"><code>c24fc1711dc1fcf02609152e8135f838b886fdd6</code></a>
using @CookieValue annotation</p>
</blockquote>
<hr />
<p>Apr 1, 2023</p>
<p><a name="index_entry_index_3"></a></p>
<h1 id="using-sessions">Using sessions</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=2605">43:25</a>]</p>
<p>Cookies are stored inside the client's computer and the client may not allow to drop such kind
of litter inside their system.</p>
<p>Cooking processing may be costly as they are just text files. Complex structures may be have
very large size. Also cookies may have size limitation.</p>
<p><img src="../../pict/session_cookie_sequence.png" class="floatRight" /></p>

<p>To address these problems there is an alternative called <strong>sessions</strong>.</p>
<p>A client sends a request. The application doesn't send the whole set of data to the client
but instead saves the session state in the database and returns to the client a response with above
single session ID.</p>
<p>On a next request the session ID cookie is sent back to the application that retrieves the session
state by this session ID and returns to the client the customized response.</p>
<p style="clear: both;"></p>

<p>In the <a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/ValidatedController.java"><code>ValidatedController</code></a>
class using setting a session attribute:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/validate-submit")
    public String showCalculatePageSpring(&lt;...&gt;,
                                          HttpSession session) {
        .  .  .
        session.setAttribute("userName", dto.getName1());
        return "result-page-spring";
    }</code></pre>
<p>Then this attribute may be used on the JSP page like <a href="../../../projects/web-app-spring-adv3/src/main/webapp/WEB-INF/view/process-email-page.jsp"><code>process-email-page.jsp</code></a>:</p>
<pre class="highlight"><code class="language-xml">.  .  .
&lt;h1&gt;Hi ${userName}!&lt;/h1&gt;
.  .  .</code></pre>
<p>Or the session attributes may be transformed and set into the model likes it's don in the
<a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/EmailController.java"><code>EmailController</code></a>
class:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/process-email")
    public String processEmail(@ModelAttribute SendEmailDto sendEmailDto,
                               HttpSession session, Model model) {
        model.addAttribute("userName", "dear " + session.getAttribute("userName"));
        return "process-email-page";
    }</code></pre>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>On a JSP page, when resolving a placeholder variable, first an attempt is done to find this
variable in the model and if not found then it's searched in the session.</p>
</div>
<p>As servers have still limited storage capacity and the number of requests and different sessions 
may be huge, it's not recommended to store unnecessary data in sessions.</p>
<blockquote>
<p>Git commit: <a href="../patches/8075a5220613199f779944e74dbadb0662189b24.html"><code>8075a5220613199f779944e74dbadb0662189b24</code></a>
session usage demonstrated</p>
</blockquote>
<hr />
<h1 id="session-timeout">Session timeout</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=4868">1:21:08</a>]</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>javax.servlet.http.HttpSession</code> is not a part of Spring.</p>
</div>
<p><a name="index_entry_index_4"></a>
It may be unreasonable or even impossible to hold used session data forever. To limit the storage
period of time (in minutes) the following parameter may be used in the <code>web.xml</code> file:</p>
<pre class="highlight"><code class="language-xml">&lt;session-config&gt; 
    &lt;session-timeout&gt;20&lt;/session-timeout&gt;
&lt;/session-config&gt;</code></pre>
<p>In the code-based configuration (e.g. in the <a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/ValidatedController.java"><code>ValidatedController</code></a>
class) the <code>javax.servlet.http.HttpSession</code> object may be used for that
(in seconds):</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/validate-submit")
    public String showCalculatePageSpring(@Valid @ModelAttribute("dto") UserInfoValidatedDto dto, 
                                          HttpSession session) {

        session.setAttribute("userName", dto.getName1());
        session.setMaxInactiveInterval(20);

        return "result-page-spring";
    }</code></pre>
<p>It's proved that after 20 seconds of inactivity the session attribute <code>userName</code> is no longer
available. We are now not going to preserve this code in the project.</p>
<hr />
<p><a name="index_entry_index_5"></a><a name="using_sessionattributes_annotation"></a></p>
<h1 id="using-sessionattributes-annotation">Using <code>@SessionAttributes</code> annotation</h1>
<p>[<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=5219">1:26:59</a>]</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Using the following approach may be pretty tricky and may take much time for investigation of
possible errors. See <a href="sessions_and_cookies.html#conversational_scope">here</a> for more
extensive explanation.</p>
<p>Also see <a href="data_binding.html#combination_modelattribute_and_sessionattributes">here</a>
to find information about combination of this and the <code>@ModelAttribute</code> annotations.</p>
</div>
<p>The <code>@org.springframework.web.bind.annotation.SessionAttributes</code> annotation is added to the 
<a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/ValidatedController.java"><code>ValidatedController</code></a>
class:</p>
<pre class="highlight"><code class="language-code">@Controller
@SessionAttributes("userInfoDto")
public class ValidatedController {

    @RequestMapping("/validate")
    public String showHomePageSpring(Model model) {
        model.addAttribute("userInfoDto", new UserInfoValidatedDto());
        return "home-page-validated";
    }
    .  .  .</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Multiple model attributes may be specified in the <code>@SessionAttributes</code> annotation. 
Also see [<a href="../references.html#ref_2_13">2.13</a>, <a href="https://youtu.be/cpFfzE9eGT0?t=5979">1:39:39</a>].</p>
</div>
<p>In the <a href="../../../projects/web-app-spring-adv3/src/main/java/springmvcstudy2/controllers/EmailController.java"><code>EmailController</code></a>
we just remove the explicit session handling code.</p>
<p>In the views:</p>
<ul>
<li><a href="../../../projects/web-app-spring-adv3/src/main/webapp/WEB-INF/view/send-email-page.jsp"><code>send-email-page.jsp</code></a> and</li>
<li><a href="../../../projects/web-app-spring-adv3/src/main/webapp/WEB-INF/view/process-email-page.jsp"><code>process-email-page.jsp</code></a></li>
</ul>
<p>We just use the specified session attribute like this:</p>
<pre class="highlight"><code class="language-xml">.  .  .
&lt;h1&gt;Hi ${userInfoDto.name1}!&lt;/h1&gt;
.  .  .</code></pre>
<blockquote>
<p>Git commit: <a href="../patches/c9a8051e03ffaea64b73eb4289e30bc8b7757769.html"><code>c9a8051e03ffaea64b73eb4289e30bc8b7757769</code></a>
@SessionAttributes annotation used</p>
</blockquote>
<hr />
<p>Apr 3, 2023</p>
<p><a name="index_entry_index_6"></a><a name="conversational_scope"></a></p>
<h1 id="conversational-scope">Conversational scope</h1>
<p>New simple project created to make the description more clear. The URL is 
<a href="http://localhost:8080/web-app-spring-sessions/ui/first">http://localhost:8080/web-app-spring-sessions/ui/first</a>.</p>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=40">0:40</a>]</p>
<blockquote>
<p>Git commit: <a href="../patches/cb5ad3e48f0e4437d2489f1c89d0247019116045.html"><code>cb5ad3e48f0e4437d2489f1c89d0247019116045</code></a>
new project created for sessions investigation</p>
</blockquote>
<p><a name="index_entry_index_7"></a></p>
<h2 id="request-scope">Request scope</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=247">4:07</a>]</p>
<p>This narration is going to be done for further comparison with the upper level scope.</p>
<p>Request scope defines data that is valid during a single request handling process, e.g. from the
request receipt to the response result sending. As the request is processed (like the rendered view
is sent to the client) the request scope is destroyed.</p>
<p>Two controller methods are defined:</p>
<pre class="highlight"><code class="language-code">@Controller
public class FirstController {

    @RequestMapping("/first")
    public String firstHandler(Model model) {
        model.addAttribute("firstName", "Jan");
        model.addAttribute("lastName", "Hus");
        return "index";
    }

    @RequestMapping("/second")
    public String secondHandler(Model model) {
        String firstName = (String) model.getAttribute("firstName");
        System.out.println("firstName=" + firstName);
        return "index";
    }
}</code></pre>
<p>The first one sets two model attributes and the second one tries to access it. The <code>Model</code> object
here has the request scope so the instances are different for the two requests and so in the
second method the requested attribute is absent:</p>
<pre class="highlight"><code class="language-shell">firstName=null</code></pre>
<p>The page is going to look like this:</p>
<p><img alt="" src="../../pict/request_scope.png" /></p>
<p>The first URL is <a href="http://localhost:8080/web-app-spring-sessions/ui/first">http://localhost:8080/web-app-spring-sessions/ui/first</a>. As for now the second 
link opens the page where all fields are empty.</p>
<blockquote>
<p>Git commit: <a href="../patches/d436f2b6408024785fc0db78d60fb17afb87ba32.html"><code>d436f2b6408024785fc0db78d60fb17afb87ba32</code></a>
request scope demonstrated</p>
</blockquote>
<h2 id="adding-conversational-scope">Adding conversational scope</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=977">16:17</a>]</p>
<p>Just add the <code>@SessionAttributes("firstName")</code> annotation to the <code>FirstController</code> controller
()see above) and see what happens:</p>
<pre class="highlight"><code class="language-code">@Controller
@SessionAttributes("firstName")
public class FirstController {
.  .  .</code></pre>
<p><img src="../../pict/session_scope_01.png" class="floatRight" /></p>

<p>When the first handler method is being called the two model attributes still exist in the <em>request 
scope</em> but the attribute <code>firstName</code> also gets copied to the <em>session scope</em> (fig. 1).</p>
<p>When the first method is finished the two model attributes are removed from the <em>request scope</em>
but the attribute <code>firstName</code> remains in the <em>session scope</em> (fig. 2).</p>
<p>When the second handler method is called the session scope attributes get copied to the 
request scope (fig. 3).</p>
<p style="clear: both;"></p>

<p>So unlike the previous case we see:</p>
<pre class="highlight"><code class="language-shell">firstName=Jan</code></pre>
<p>And the second link shown above opens the page where the first field "First name" is filled.</p>
<blockquote>
<p>Git commit: <a href="../patches/1d9d6953266063c12e596435649660927dd3f4e9.html"><code>1d9d6953266063c12e596435649660927dd3f4e9</code></a>
@SessionAttributes annotation added</p>
</blockquote>
<p><a name="index_entry_index_8"></a></p>
<h2 id="specify-scope-explicitly-in-jsp-page">Specify scope explicitly in JSP page</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=1970">32:50</a>]</p>
<p>In the JSP page add:</p>
<pre class="highlight"><code class="language-xml">.  .  .
&lt;strong&gt;First name from the request: &lt;/strong&gt;${requestScope.firstName}&lt;br /&gt;
&lt;strong&gt;First name from the session: &lt;/strong&gt;${sessionScope.firstName}&lt;br /&gt;
.  .  .</code></pre>
<p>that'll show that the attribute values are the same.</p>
<blockquote>
<p>Git commit: <a href="../patches/16b36af28355aa6dbd3fcafcdb86a6c5416cf0c2.html"><code>16b36af28355aa6dbd3fcafcdb86a6c5416cf0c2</code></a>
scopes explicitly specified</p>
</blockquote>
<h2 id="get-things-simpler">Get things simpler</h2>
<p>Specify the other field as session scoped:</p>
<p><pre class="highlight"><code class="language-code">@Controller
@SessionAttributes({"firstName", "lastName"})
public class FirstController {
.  .  .</code></pre>
[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=1970">32:50</a>]
Now we don't need to even mention the model attributes in the second handler:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/second")
    public String secondHandler() {
        return "index";
    }</code></pre>
<p>This will work as in the JSP page the attributes <code>${firstName}</code> and <code>${lastName}</code> will be first
looked up in the request scope and then, if not found, in the session scope.</p>
<blockquote>
<p>Git commit: <a href="../patches/b01d7a7d88001fca72b3a270b4f6e085293c1d05.html"><code>b01d7a7d88001fca72b3a270b4f6e085293c1d05</code></a>
all attributes added to the session scope</p>
</blockquote>
<p><a name="index_entry_index_9"></a></p>
<h2 id="completing-the-conversation">Completing the conversation</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=2704">45:04</a>]</p>
<p>In the second handler method adding a <code>org.springframework.web.bind.support.SessionStatus</code> 
parameter and using it for the session completion:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/second")
    public String secondHandler(SessionStatus status) {
        status.setComplete();
        return "index";
    }

    @RequestMapping("/third")
    public String thirdHandler() {
        return "index";
    }</code></pre>
<p>After that, in the third handler method the session attributes will be absent.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the <code>setComplete()</code> method clears up only the attributes that were set using the 
<code>@SessionAttributes</code> annotation. This method does not remove the session attributes that were
set using the <code>javax.servlet.http.HttpSession</code> object (see 
<a href="sessions_and_cookies.html">below</a>#httpsession_vs_sessionattribute).</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/d83ff8a17189a88904f1f954e80e976b68f44e99.html"><code>d83ff8a17189a88904f1f954e80e976b68f44e99</code></a>
conversation completing demonstrated</p>
</blockquote>
<h2 id="restrictions-on-sessionattributes-annotation">Restrictions on <code>@SessionAttributes</code> annotation</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=3821">1:03:41</a>]</p>
<p>Javadoc of <code>org.springframework.web.bind.annotation.SessionAttributes</code> states that usage of
conversation scope with <code>@SessionAttributes</code> annotation among different controllers may be buggy.
For exchanging data between different controllers it's better to use 
<code>javax.servlet.http.HttpSession</code> object or solutions like Spring authentication that is going
to be discussed later.</p>
<p>Addin a new controller:</p>
<pre class="highlight"><code class="language-code">@Controller
public class SecondController {

    @RequestMapping("/normalMethod")
    public String normalHandler(Model model) {
        String firstName = (String) model.getAttribute("firstName");
        System.out.println("Inside normal handler firstName=" + firstName);
        return "index";
    }
}</code></pre>
<p>In the handler method <code>normalHandler</code> the <code>firstName</code> attribute will be absent:</p>
<pre class="highlight"><code class="language-shell">Inside normal handler firstName=null</code></pre>
<p>But in the JSP view the corresponding attributes will be taken from the session.</p>
<p>Let's try to fix it:</p>
<pre class="highlight"><code class="language-code">@Controller
public class SecondController {

    @RequestMapping("/normalMethod")
    public String normalHandler(@SessionAttribute("firstName") String firstName, Model model) {
        System.out.println("Inside normal handler firstName=" + firstName);
        model.addAttribute("firstName", "Dear " + firstName);
        return "index";
    }
}</code></pre>
<p>This will work:</p>
<pre class="highlight"><code class="language-shell">Inside normal handler firstName=Jan</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a name="index_entry_index_10"></a>
Mind the fact that <code>@org.springframework.web.bind.annotation.SessionAttribute</code> is a different 
annotation.</p>
</div>
<p>But there may be problems like the following. The solution works if we navigate from the first
handler method to the normal method of the second controller (see the picture below). </p>
<p><img alt="" src="../../pict/conversational_scope.png" /></p>
<p>But if we navigate to the normal method from the second handler method (where the session is
completed) the following error will be returned:</p>
<pre class="highlight"><code>HTTP ERROR 400 Missing session attribute 'firstName' of type String</code></pre>
<blockquote>
<p>Git commit: <a href="../patches/24248224450db59173c41fd9960d39482c0cc206.html"><code>24248224450db59173c41fd9960d39482c0cc206</code></a>
problem with @SessionAttribute annotation</p>
</blockquote>
<p><a name="httpsession_vs_sessionattribute"></a></p>
<h2 id="httpsession-vs-sessionattribute"><code>HttpSession</code> vs <code>@SessionAttribute</code></h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=5621">1:33:41</a>]</p>
<p>The changes were done to add a new attribute <code>address</code> to the normal <code>HttpSession</code> session.
See the below commit for more details.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>HttpSession</code> and <code>@SessionAttribute</code> are managed differently. So the 
<code>SessionStatus#setComplete</code> method does not clear the <code>HttpSession</code> object attributes.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/f4f5cca9ade31118a069a5c9b6209e5cc3b0cd2f.html"><code>f4f5cca9ade31118a069a5c9b6209e5cc3b0cd2f</code></a>
using HttpSession object</p>
</blockquote>
<p><a name="index_entry_index_11"></a></p>
<h2 id="clearing-up-the-httpsession-session">Clearing up the <code>HttpSession</code> session</h2>
<p>[<a href="../references.html#ref_2_14">2.14</a>, <a href="https://youtu.be/ezty6XhOpF8?t=6702">1:51:42</a>]</p>
<p><code>HttpSession</code> may be invalidating using the <code>invalidate()</code> method:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/invalidate")
    public String invalidateHandler(HttpSession session) {
        session.invalidate();
        return "index";
    }</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that the attribute set by the <code>@SessionAttributes</code> annotation will not be removed by the 
<code>invalidate()</code> method.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/3e1a46fdea00dc7ef5c96e0bc9876b8d5e978402.html"><code>3e1a46fdea00dc7ef5c96e0bc9876b8d5e978402</code></a>
invalidating HttpSession object</p>
</blockquote>
<hr />
<p><a name="index_entry_index_12"></a></p>
<h1 id="cookies-url-encoding">Cookies URL encoding</h1>
<p>[<a href="../references.html#ref_2_15">2.15</a>, <a href="https://youtu.be/laZnez5VzV4?t=8912">2:28:32</a>]</p>
<p>If a user disables cookies in their browser Spring MVC can probably transmit the session ID
through the URL. This needs additional exploration.</p>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="send_email.html" 
title="Previous: Send email"><img src="../../layout/pict/previous_page.png"/></a>

<a href="service_layer.html" title="Next: Service layer"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>




</body>
</html>
