<!DOCTYPE html>
<html>
<head><title>Spring MVC Formatter</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>
<link rel="stylesheet" type="text/css" href="../../theme.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web</span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a>

<a href="../../../doc_src/content/intermediate/formatters.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="form_validation.html" title="Previous: Form validation"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="send_email.html" title="Next: Send email"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Spring MVC Formatter</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item"><a href="../../../readme.html">About the course</a></div>
<div class="sidebar_item"><a href="../references.html">References</a></div>
<div class="sidebar_item"><a href="../common_notes.html">Common notes</a></div>
            <h3>Beginner</h3>
            <div class="sidebar_item"><a href="../beginner/about_part_1.html">About this part</a></div>
<div class="sidebar_item"><a href="../beginner/server_setup.html">Server setup</a></div>
<div class="sidebar_item"><a href="../beginner/front_controller.html">Front controller</a></div>
<div class="sidebar_item"><a href="../beginner/spring_web_app_setup.html">Spring web application setup</a></div>
<div class="sidebar_item"><a href="../beginner/web_application_context.html">Web application context</a></div>
<div class="sidebar_item"><a href="../beginner/view_resolver.html">View resolver</a></div>
<div class="sidebar_item"><a href="../beginner/model.html">Model</a></div>
            <h3>Intermediate</h3>
            <div class="sidebar_item"><a href="about_part_2.html">About this part</a></div>
<div class="sidebar_item"><a href="get_rid_of_web_xml.html">Get rid of XML configuration</a></div>
<div class="sidebar_item"><a href="data_binding.html">Data binding</a></div>
<div class="sidebar_item"><a href="registration_form.html">Registration form</a></div>
<div class="sidebar_item"><a href="form_validation.html">Form validation</a></div>
<div class="sidebar_item selected"><a href="formatters.html">Spring MVC Formatter</a></div>
<div class="sidebar_item"><a href="send_email.html">Send email</a></div>
<div class="sidebar_item"><a href="sessions_and_cookies.html">Sessions and cookies</a></div>
<div class="sidebar_item"><a href="service_layer.html">Service layer</a></div>
<div class="sidebar_item"><a href="exception_handling.html">Exception handling</a></div>
            <h3>Sidesteps</h3>            
            <div class="sidebar_item"><a href="../sidesteps/sidesteps.html">Sidesteps</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.2
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Spring MVC Formatter</p>

<div class="toc">
<ul>
<li><a href="#about-this-section">About this section</a></li>
<li><a href="#adding-internal-dtos">Adding internal DTOs</a></li>
<li><a href="#introducing-formatter">Introducing Formatter</a></li>
<li><a href="#using-the-print-method">Using the print() method</a></li>
<li><a href="#using-locale">Using Locale</a></li>
<li><a href="#initbinder-introduction">InitBinder introduction</a></li>
<li><a href="#property-editor">Property editor</a></li>
<li><a href="#built-in-property-editors">Built-in property editors</a></li>
<li><a href="#writing-a-custom-property-editor">Writing a custom property editor</a></li>
<li><a href="#converter-interface">Converter interface</a></li>
</ul>
</div>
<hr />
<p>Mar 27, 2023</p>
<h1 id="about-this-section">About this section</h1>
<p>In this section the following implementations of data conversion mechanism is going to be discussed:</p>
<ul>
<li>Formatters</li>
<li>Property editors</li>
<li>Converters</li>
</ul>
<hr />
<p><a name="index_entry_index_1"></a></p>
<h1 id="adding-internal-dtos">Adding internal DTOs</h1>
<p>[<a href="../references.html#ref_2_9">2.9</a>, <a href="https://youtu.be/q9hjjeJA7Yw?t=381">6:21</a>]</p>
<p>A new DTO <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/model/CommunicationDto.java"><code>CommunicationDto</code></a>
is created and added as the field <code>communicationDto</code> in the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/model/RegistrationDto.java"><code>RegistrationDto</code></a>
DTO.</p>
<p><a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/model/PhoneDto.java"><code>PhoneDto</code></a> is created
and added to the <code>CommunicationDto</code>. This DTO contains two fields <code>countryCode</code> and <code>userNumber</code>
but we will try to represent it in the view as a single text input field.</p>
<p>The views <a href="../../../projects/web-app-spring-adv2/src/main/webapp/view/registration-page.jsp"><code>registration-page.jsp</code></a>
and <a href="../../../projects/web-app-spring-adv2/src/main/webapp/view/registration-success.jsp"><code>registration-success.jsp</code></a>
are updated to reflect the corresponding fields.</p>
<p>In the view the email field is accessed the following way:</p>
<pre class="highlight"><code class="language-xml">.  .  .
&lt;/p&gt;&lt;label for="email"&gt;Email: &lt;/label&gt;&lt;form:input id="email" path="communicationDto.email"/&gt;&lt;/p&gt;
.  .  .</code></pre>
<p>But this does not work for the <code>communicationDto.phone</code> field as it's not a <code>String</code>.
On the other hand the field <code>private int age;</code> is accepted successfully as Spring MVC can
automatically convert some known data types. The solution about the <code>phone</code> field is going to be 
discussed later.</p>
<blockquote>
<p>Git commit: <a href="../patches/5a14f9a34017c2c5e63c04cf25ec035718df987d.html"><code>5a14f9a34017c2c5e63c04cf25ec035718df987d</code></a>
composite DTOs implemented</p>
</blockquote>
<hr />
<p><a name="index_entry_index_2"></a></p>
<h1 id="introducing-formatter">Introducing <code>Formatter</code></h1>
<p>[<a href="../references.html#ref_2_9">2.9</a>, <a href="https://youtu.be/q9hjjeJA7Yw?t=2127">35:27</a>]</p>
<p>The <code>org.springframework.format.Formatter</code> interface is used in Spring MVC and Spring Boot as well.</p>
<p>the implementation <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/config/formatter/PhoneNumberFormatter.java"><code>PhoneNumberFormatter</code></a>
is created:</p>
<pre class="highlight"><code class="language-code">public class PhoneNumberFormatter implements Formatter&lt;PhoneDto&gt; {

    @Override
    public String print(PhoneDto object, Locale locale) {
        return null;
    }

    @Override
    public PhoneDto parse(String text, Locale locale) {
        System.out.println("inside PhoneNumberFormatter#parse");
        String[] split = text.replaceAll("\\s", "").split("-");
        PhoneDto phoneDto = new PhoneDto();
        phoneDto.setCountryCode(split[0]);
        phoneDto.setUserNumber(split[1]);
        return phoneDto;
    }
}</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Spring MVC will only call the <code>parse()</code> method if the parsing is required. It will not call it
if a user entered nothing to the corresponding field.</p>
</div>
<p>Looks like the <code>print()</code> method will not be used for converting from a <code>PhoneDto</code> to a <code>String</code>, so 
<code>PhoneDto#toString()</code> method is used instead:</p>
<pre class="highlight"><code class="language-code">    @Override
    public String toString() {
        return this.getCountryCode() + "-" + this.getUserNumber();
    }</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>print()</code> method is used for the other purpose that is described 
<a href="formatters.html#using_print_method">here</a>.</p>
</div>
<p><a name="index_entry_index_3"></a>
To register a <code>Formatter</code> in the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/config/MyApplicationConfig.java"><code>MyApplicationConfig</code></a>
configuration the configuration class must implement the interface
<code>org.springframework.web.servlet.config.annotation.WebMvcConfigurer</code>. The registration is done
like this:</p>
<pre class="highlight"><code class="language-code">    @Override
    public void addFormatters(FormatterRegistry registry) {
        registry.addFormatter(new PhoneNumberFormatter());
    }</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When an implementation of the <code>org.springframework.format.Parser#parse</code> method returns <code>null</code>
a <code>NullPointerException</code> exception is output to the log.</p>
</div>
<p>The pictures are not going to be demonstrated as they are not changed very much. The previous 
versions od these forms can be view <a href="registration_form.html#registration_forms">here</a>.</p>
<blockquote>
<p>Git commit: <a href="../patches/5d9d526ce3ef71d5d231c5d1e2230ff77e4c50c3.html"><code>5d9d526ce3ef71d5d231c5d1e2230ff77e4c50c3</code></a>
Spring NVC Formatter used</p>
</blockquote>
<hr />
<p><a name="using_print_method"></a></p>
<h1 id="using-the-print-method">Using the <code>print()</code> method</h1>
<p>[<a href="../references.html#ref_2_9">2.9</a>, <a href="https://youtu.be/q9hjjeJA7Yw?t=4007">1:06:47</a>]</p>
<p>The print method is used when the form is populated with the model object that is already filled up,
e.g. taken from a database. For demonstration the controller method <code>showRegistrationPage</code> of
the controller <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/controllers/RegistrationController.java"><code>RegistrationController</code></a>
is changed to prepopulate the phone number:</p>
<pre class="highlight"><code class="language-code">    @RequestMapping("/register")
    public String showRegistrationPage(@ModelAttribute("userReg") RegistrationDto userReg) {

        CommunicationDto communicationDto = new CommunicationDto();
        PhoneDto phoneDto = new PhoneDto();
        phoneDto.setCountryCode("000");
        phoneDto.setUserNumber("0000000000");
        communicationDto.setPhone(phoneDto);
        userReg.setCommunicationDto(communicationDto);

        return "registration-page";
    }</code></pre>
<p>The <code>print()</code> method of the formatter <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/config/formatter/PhoneNumberFormatter.java"><code>PhoneNumberFormatter</code></a>
is changed like this:</p>
<pre class="highlight"><code class="language-code">    @Override
    public String print(PhoneDto object, Locale locale) {
        return object.getCountryCode() + "-" + object.getUserNumber();
    }</code></pre>
<p>So now when the form is initially loaded the phone number is "000-0000000000".</p>
<blockquote>
<p>Git commit: <a href="../patches/8d937092461422607d8595e0eb3c91ad7db42a56.html"><code>8d937092461422607d8595e0eb3c91ad7db42a56</code></a>
formatter print() method demonstrated</p>
</blockquote>
<hr />
<h1 id="using-locale">Using Locale</h1>
<p>[<a href="../references.html#ref_2_9">2.9</a>, <a href="https://youtu.be/q9hjjeJA7Yw?t=6035">1:40:35</a>]</p>
<p>At this time stamp the money amount conversion and presentation is discussed, but it's not going
to be followed as it's a little bit out of scope of the current goals.</p>
<hr />
<p>Mar 28, 2023</p>
<p><a name="index_entry_index_4"></a></p>
<h1 id="initbinder-introduction">InitBinder introduction</h1>
<p>[<a href="../references.html#ref_2_11">2.11</a>, <a href="https://youtu.be/ms4ywje7EYI?t=330">5:30</a>]</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See <a href="data_binding.html#controlleradvice_annotation">here</a> for information about using
this annotation <strong>globally</strong>.</p>
</div>
<p>In the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/controllers/RegistrationController.java"><code>RegistrationController</code></a>
class add the following method:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @InitBinder
    public void initBinder(WebDataBinder dataBinder) {
        System.out.println("inside @InitBinder method");
        dataBinder.setDisallowedFields("name");
    }
    .  .  .</code></pre>
<p>The annotation we use is <code>@org.springframework.web.bind.annotation.InitBinder</code>. </p>
<p>This method will be called each time any request handler method of this controller is called.
In this example it removes the field named <code>name</code> from the data model.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Actually this field is sent in the URL
<code>http://localhost:8080/web-app-spring-adv2/ui/registration-success?name=aaaaa&amp;userName=bbbbb&amp;...</code>,
it's just not shown on the page.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/79b9c52328730769fd4f43190a81e98357105220.html"><code>79b9c52328730769fd4f43190a81e98357105220</code></a>
property editor basics</p>
</blockquote>
<hr />
<p><a name="index_entry_index_5"></a></p>
<h1 id="property-editor">Property editor</h1>
<p>[<a href="../references.html#ref_2_11">2.11</a>, <a href="https://youtu.be/ms4ywje7EYI?t=1911">31:51</a>]</p>
<p>In the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/controllers/RegistrationController.java"><code>RegistrationController</code></a>
class <code>@InitBinder</code> annotated method register a <code>StringTrimmerEditor</code>:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @InitBinder
    public void initBinder(WebDataBinder dataBinder) {
        System.out.println("inside @InitBinder method");
        StringTrimmerEditor trimmerEditor = new StringTrimmerEditor(true);
        dataBinder.registerCustomEditor(String.class, "name", trimmerEditor);
    }
    .  .  .</code></pre>
<p>Then the value of the <code>name</code> field will be trimmed. This is a simple example demonstrating the 
property editor concept.</p>
<p>If a text is entered into a text field that represent, for example, an integer model field, the 
property editing concept works for transformation. There's a default data binder that was
implicitly used in our previous examples. But just the simplest automatic data binding is 
activated by default. For more complex cases we need to write our custom data binders.</p>
<p>The <code>WebDataBinder</code> object allow us registering:</p>
<ul>
<li>custom editors;</li>
<li>validators;</li>
<li>"required" properties;</li>
<li>allowed/disallowed properties.</li>
</ul>
<hr />
<h1 id="built-in-property-editors">Built-in property editors</h1>
<p>[<a href="../references.html#ref_2_11">2.11</a>, <a href="https://youtu.be/ms4ywje7EYI?t=2615">43:35</a>]</p>
<p>For the Built-in property editors list see [<a href="../references.html#ref_15">15</a>, 
<a href="https://docs.spring.io/spring-framework/docs/5.3.9/reference/html/core.html#beans-beans-conversion">3.3.2. Built-in <code>PropertyEditor</code> Implementations</a>].</p>
<p>Some demonstration is done in the video about the property editor usage that are too long and
not so much important for the goals of this course.</p>
<hr />
<h1 id="writing-a-custom-property-editor">Writing a custom property editor</h1>
<p>[<a href="../references.html#ref_2_11">2.11</a>, <a href="https://youtu.be/ms4ywje7EYI?t=4278">1:11:18</a>]</p>
<p>We are going to convert the "Name" field to upper case. It's pretty simple. First create a new 
property editor <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/propertyeditor/NamePropertyEditor.java"><code>NamePropertyEditor</code></a>:</p>
<p><a name="index_entry_index_6"></a>
<pre class="highlight"><code class="language-code">public class NamePropertyEditor extends PropertyEditorSupport {

    @Override
    public void setAsText(String text) throws IllegalArgumentException {
        setValue(text.toUpperCase());
    }
}</code></pre></p>
<p>The <code>setValue()</code> method comes from the <code>java.beans.PropertyEditorSupport</code> base class.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>PropertyEditorSupport</code> class has the method <code>getAsText()</code> that id analogous to the 
method <code>print()</code> of the <code>Formatter</code> interface (see 
<a href="formatters.html#using_print_method">here</a>).</p>
</div>
<p>Then we just add the newly created property editor to the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/controllers/RegistrationController.java"><code>RegistrationController</code></a>
class:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @InitBinder
    public void initBinder(WebDataBinder dataBinder) {
        System.out.println("inside @InitBinder method");
        StringTrimmerEditor trimmerEditor = new StringTrimmerEditor(true);
        dataBinder.registerCustomEditor(String.class, "name", trimmerEditor);
        dataBinder.registerCustomEditor(String.class, "name", new NamePropertyEditor());
    }
    .  .  .</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Looks like the previous <code>StringTrimmerEditor</code> property editor stops working after registering
a new property editor.</p>
</div>
<blockquote>
<p>Git commit: <a href="../patches/8e545bf252eed82ecc3cb873937c975470860df2.html"><code>8e545bf252eed82ecc3cb873937c975470860df2</code></a>
custom property editor implemented</p>
</blockquote>
<hr />
<p><a name="index_entry_index_7"></a><a name="converter_interface"></a></p>
<h1 id="converter-interface"><code>Converter</code> interface</h1>
<p>[<a href="../references.html#ref_2_11">2.11</a>, <a href="https://youtu.be/ms4ywje7EYI?t=6769">1:52:49</a>]</p>
<p>There's yet another mechanism for converting &mdash; the parameterized
<code>org.springframework.core.convert.converter.Converter</code> interface that has the <code>convert()</code> method
that concrete converters must override and where actual conversion is performed.
The converters must be added in the configuration class like <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/config/MyApplicationConfig.java"><code>MyApplicationConfig</code></a>
in the <code>addFormatters()</code> method using the <code>FormatterRegistry#addConverter</code> method.</p>
<p>The <code>Converter</code> interface has only a one-way conversion method. For the reverse conversion another 
converter must be created.</p>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="form_validation.html" 
title="Previous: Form validation"><img src="../../layout/pict/previous_page.png"/></a>

<a href="send_email.html" title="Next: Send email"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
