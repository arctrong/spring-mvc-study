<!DOCTYPE html>
<html>
<head><title>Form validation</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>
<link rel="stylesheet" type="text/css" href="../../theme.css"/>

<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web</span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a>

<a href="../../../doc_src/content/intermediate/form_validation.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="registration_form.html" title="Previous: Registration form"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="formatters.html" title="Next: Spring MVC Formatter"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Form validation</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            <div class="sidebar_item"><a href="../../../readme.html">About the course</a></div>
<div class="sidebar_item"><a href="../references.html">References</a></div>
<div class="sidebar_item"><a href="../common_notes.html">Common notes</a></div>
            <h3>Beginner</h3>
            <div class="sidebar_item"><a href="../beginner/about_part_1.html">About this part</a></div>
<div class="sidebar_item"><a href="../beginner/server_setup.html">Server setup</a></div>
<div class="sidebar_item"><a href="../beginner/front_controller.html">Front controller</a></div>
<div class="sidebar_item"><a href="../beginner/spring_web_app_setup.html">Spring web application setup</a></div>
<div class="sidebar_item"><a href="../beginner/web_application_context.html">Web application context</a></div>
<div class="sidebar_item"><a href="../beginner/view_resolver.html">View resolver</a></div>
<div class="sidebar_item"><a href="../beginner/model.html">Model</a></div>
            <h3>Intermediate</h3>
            <div class="sidebar_item"><a href="about_part_2.html">About this part</a></div>
<div class="sidebar_item"><a href="get_rid_of_web_xml.html">Get rid of XML configuration</a></div>
<div class="sidebar_item"><a href="data_binding.html">Data binding</a></div>
<div class="sidebar_item"><a href="registration_form.html">Registration form</a></div>
<div class="sidebar_item selected"><a href="form_validation.html">Form validation</a></div>
<div class="sidebar_item"><a href="formatters.html">Spring MVC Formatter</a></div>
            <h3>Useful links</h3>
            <div class="sidebar_item"><a href="https://spring.io/">Spring site</a></div>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by md2html_py 1.0.2
            <br />2023-03-27 15:01:31
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Form validation</p>

<div class="toc">
<ul>
<li><a href="#form-validation">Form validation</a><ul>
<li><a href="#why-server-side-validation">Why server-side validation</a></li>
<li><a href="#introducing-bean-validation-api">Introducing bean validation API</a></li>
<li><a href="#implementing-bean-validation">Implementing bean validation</a></li>
</ul>
</li>
<li><a href="#making-the-form-pretty">Making the form pretty</a></li>
<li><a href="#combine-front-end-and-back-end-validations">Combine front-end and back-end validations</a></li>
<li><a href="#final-steps">Final steps</a></li>
</ul>
</div>
<hr />
<p>Mar 27, 2023</p>
<p><a name="index_entry_index_1"></a></p>
<h1 id="form-validation">Form validation</h1>
<p>[<a href="../references.html#ref_2_8">2.8</a>]</p>
<p><a name="front_end_validation"></a></p>
<h2 id="why-server-side-validation">Why server-side validation</h2>
<p>Why we need a server side validation rather than client side one? If we add a simple validation 
in JavaScript like this (see the <a href="../../../projects/web-app-spring-adv2/src/main/webapp/view/home-page.jsp"><code>home-page.jsp</code></a> file):</p>
<pre class="highlight"><code class="language-code">&lt;script type="text/javascript"&gt;
function validateUserName() {
    if (document.getElementById("name1").value.length &gt; 1) {
        return true
    } else {
        alert("The user name must be at least 2 character long!")
        return false
    }
}
&lt;/script&gt;
.  .  .
&lt;form action="calculate-page-dto" method="GET" onsubmit="return validateUserName()"&gt;
.  .  .</code></pre>
<p>This validation rule will work but a user may easily break it using, e.g., a debugger tool in their
browser.</p>
<p>So we need to perform validation on the server where users cannot manipulate the code.</p>
<blockquote>
<p>Git commit: <code>ecc1819727ac509d8be35d521787c5e0b13b7953</code> client-side validation</p>
</blockquote>
<h2 id="introducing-bean-validation-api">Introducing bean validation API</h2>
<p>[<a href="../references.html#ref_2_8">2.8</a>, <a href="https://youtu.be/ot-TI5T7-5M?t=1851">30:51</a>]</p>
<p>Bean validation API 2.0 (JSR-380) is used. The previous versions are JSR-303 and JSR-349.
For more details about JCP see <a href="../common_notes.html#jcp">here</a>. Also see [<a href="../references.html#ref_13">13</a>].</p>
<p>The JSR-380 standard is supported by Spring starting from version 5.2.</p>
<p>We are going to use <strong>Hibernate validator</strong>, version 6.0+. See [<a href="../references.html#ref_14">14</a>] for the implementations
discovered so far.</p>
<h2 id="implementing-bean-validation">Implementing bean validation</h2>
<p>[<a href="../references.html#ref_2_8">2.8</a>, <a href="https://youtu.be/ot-TI5T7-5M?t=2212">36:52</a>]</p>
<p>For this demonstration we create separate artifacts:</p>
<ul>
<li>a new controller <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/controllers/ValidatedController.java"><code>ValidatedController</code></a></li>
<li>a new DTO <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/model/UserInfoValidatedDto.java"><code>UserInfoValidatedDto</code></a>
    (probably with not a good name)</li>
<li>a new home page <a href="../../../projects/web-app-spring-adv2/src/main/webapp/view/home-page-validated.jsp"><code>home-page-validated.jsp</code></a></li>
</ul>
<p>Need to add the following dependencies to the <a href="../../../projects/web-app-spring-adv2/pom.xml">POM</a>:</p>
<pre class="highlight"><code class="language-xml">        .  .  .
        &lt;dependency&gt;
            &lt;groupId&gt;javax.validation&lt;/groupId&gt;
            &lt;artifactId&gt;validation-api&lt;/artifactId&gt;
            &lt;version&gt;2.0.1.Final&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.hibernate&lt;/groupId&gt;
            &lt;artifactId&gt;hibernate-validator&lt;/artifactId&gt;
            &lt;version&gt;8.0.0.Final&lt;/version&gt;
        &lt;/dependency&gt;
        .  .  .</code></pre>
<p>The first one is just a set of interfaces. The second one is a concrete implementation (Hibernate).
Without the later dependency validation will not work.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a name="index_entry_index_2"></a>
<code>@EnableWebMvc</code> annotation must be activated on the configuration to activate validation, 
see the <a href="../../../projects/web-app-spring-adv2/src/main/java/springmvcstudy2/config/MyApplicationConfig.java"><code>MyApplicationConfig</code></a>
class.</p>
</div>
<p>After validation is activated the following lines are output to the log when the server starts:</p>
<pre class="highlight"><code class="language-shell">Mar 27, 2023 12:24:29 AM org.hibernate.validator.internal.util.Version &lt;clinit&gt;
INFO: HV000001: Hibernate Validator 6.1.6.Final</code></pre>
<p><a name="index_entry_index_3"></a>
Validation rules are defined in the DTO:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @NotBlank(message = " * can't be blank")
    @Length(min = 3, message = " * must have at least 3 characters")
    private String name1;
    .  .  .</code></pre>
<p>The controller has the following controller methods:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @RequestMapping("/validate")
    public String showHomePageSpring(@ModelAttribute("dto") UserInfoValidatedDto dto) {
        return "home-page-validated";
    }

    @RequestMapping("/validate-submit")
    public String showCalculatePageSpring(@Valid @ModelAttribute("dto") UserInfoValidatedDto dto,
                                          BindingResult result) {
        if (result.hasErrors()) {
            result.getAllErrors().forEach(System.out::println);
            return "home-page-validated";
        }
        return "result-page-spring";
    }
    .  .  .</code></pre>
<p><a name="index_entry_index_4"></a>
The <code>@Valid</code> annotation states that the DTO must be valid according to the rules defined in it.
The <code>BindingResult</code> object provides access to the validation errors. Were in case of errors we 
return the same form page preventing the next page to be shown. The debug print outputs
information like this:</p>
<pre class="highlight"><code class="language-wrapped-shell-error">Field error in object 'dto' on field 'name1': rejected value []; codes [Length.dto.name1,Length.name1,Length.java.lang.String,Length]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [dto.name1,name1]; arguments []; default message [name1],2147483647,3]; default message [ * must have at least 3 characters]
Field error in object 'dto' on field 'name1': rejected value []; codes [NotBlank.dto.name1,NotBlank.name1,NotBlank.java.lang.String,NotBlank]; arguments [org.springframework.context.support.DefaultMessageSourceResolvable: codes [dto.name1,name1]; arguments []; default message [name1]]; default message [ * can't be blank]</code></pre>
<p>The JSP form looks like this:</p>
<pre class="highlight"><code class="language-xml">.  .  .
&lt;form:form action="validate-submit" method="GET" modelAttribute="dto"&gt;
&lt;p&gt;&lt;label for="name1"&gt;Name 1: &lt;/label&gt;&lt;form:input id="name1" path="name1"/&gt;
&lt;form:errors path="name1"/&gt;&lt;/p&gt;
&lt;p&gt;&lt;label for="name2"&gt;Name 2: &lt;/label&gt;&lt;form:input id="name2" path="name2"/&gt;&lt;/p&gt;
&lt;input type="submit" value="calculate"/&gt;
&lt;/form:form&gt;
.  .  .</code></pre>
<p>The <code>&lt;form:errors path="name1"/&gt;</code> element outputs the list of errors (if any) for the specified 
field.</p>
<blockquote>
<p>Git commit: <code>764155fd65a55162d5e23e6501eb4cd1bdbc11ed</code> server-side form validation implemented</p>
</blockquote>
<p>The URL is <a href="http://localhost:8080/web-app-spring-adv2/ui/validate">http://localhost:8080/web-app-spring-adv2/ui/validate</a>:</p>
<p><img alt="" src="../../pict/validated_form.png" /></p>
<p>This snapshot was taken after the following styling is done.</p>
<hr />
<h1 id="making-the-form-pretty">Making the form pretty</h1>
<p>[<a href="../references.html#ref_2_8">2.8</a>, <a href="https://youtu.be/ot-TI5T7-5M?t=3609">1:00:09</a>]</p>
<p>The following commit makes the form look a little bit better.</p>
<blockquote>
<p>Git commit: <code>bab5cc787395af429e3bad90239a3b6f2ee4264b</code> form styling performed</p>
</blockquote>
<hr />
<h1 id="combine-front-end-and-back-end-validations">Combine front-end and back-end validations</h1>
<p>[<a href="../references.html#ref_2_8">2.8</a>, <a href="https://youtu.be/ot-TI5T7-5M?t=4102">1:08:22</a>]</p>
<p>The discussed approach is useful for avoiding expensive and time consuming interactions and
calculations. Still this guarantees that the validation will be done even if the used breaks
the validation rules in a browser. It's not going to be reproduced, see 
<a href="form_validation.html#front_end_validation">here</a> to have the main idea of the solution.</p>
<hr />
<h1 id="final-steps">Final steps</h1>
<p>[<a href="../references.html#ref_2_8">2.8</a>, <a href="https://youtu.be/ot-TI5T7-5M?t=4321">1:12:01</a>]</p>
<p>Another checkbox "I am not a robot" added and the other input field is validated.</p>
<blockquote>
<p>Git commit: <code>b5a88ff0cdb251e3f4480bd6fabba3c8cc7f440f</code> final steps</p>
</blockquote>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="registration_form.html" 
title="Previous: Registration form"><img src="../../layout/pict/previous_page.png"/></a>

<a href="formatters.html" title="Next: Spring MVC Formatter"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>

</body>
</html>
