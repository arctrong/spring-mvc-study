<!DOCTYPE html>
<html>
<head><title>Service layer</title>
<meta charset="utf-8">
<link rel="shortcut icon" type="image/png" href="../../favicon.png"/>
<link rel="stylesheet" type="text/css" href="../../layout/styles.css"/>
<link rel="stylesheet" type="text/css" href="../../layout/layout.css"/>

<link rel="stylesheet" type="text/css" href="../../theme.css"/>
<style>
.headerNavArrows {position: relative; top: 3px;}
</style>
</head>
<body>

<div class="header"><b><span style="color:greenyellow;margin-right:7px;">Spring Web<span class="localOnly" title="Unrestricted">*</span></span></b><a 
class="header_item" href="../../../readme.html">About</a><a 
class="header_item" href="../index_page.html">Index</a><a 
class="header_item" href="https://github.com/arctrong/spring-mvc-study">GitHub</a>

<a href="../../../doc_src/content/intermediate/service_layer.txt " class="header_item_source" title="Source text">&lt;/&gt;</a>


<a href="sessions_and_cookies.html" title="Previous: Sessions and cookies"><img class="headerNavArrows" src="../../layout/pict/previous_page_h18px.png"/></a>

<a href="exception_handling.html" title="Next: Exception handling"><img class="headerNavArrows" src="../../layout/pict/next_page_h18px.png"/></a>


<span class="headerTitle">Service layer</span>

</div>

<div class="sidebar">
    <table class="sidebarAligner">
        <tr><td valign="top">
            
            <a href="../../../readme.html" class="sidebar_item">About the course</a>
<a href="../references.html" class="sidebar_item">References</a>
<a href="../common_notes.html" class="sidebar_item">Common notes</a>
            <h3>Beginner</h3>
            <a href="../beginner/about_part_1.html" class="sidebar_item">About this part</a>
<a href="../beginner/server_setup.html" class="sidebar_item">Server setup</a>
<a href="../beginner/front_controller.html" class="sidebar_item">Front controller</a>
<a href="../beginner/spring_web_app_setup.html" class="sidebar_item">Spring web application setup</a>
<a href="../beginner/web_application_context.html" class="sidebar_item">Web application context</a>
<a href="../beginner/view_resolver.html" class="sidebar_item">View resolver</a>
<a href="../beginner/model.html" class="sidebar_item">Model</a>
            <h3>Intermediate</h3>
            <a href="about_part_2.html" class="sidebar_item">About this part</a>
<a href="get_rid_of_web_xml.html" class="sidebar_item">Get rid of XML configuration</a>
<a href="data_binding.html" class="sidebar_item">Data binding</a>
<a href="registration_form.html" class="sidebar_item">Registration form</a>
<a href="form_validation.html" class="sidebar_item">Form validation</a>
<a href="formatters.html" class="sidebar_item">Spring MVC Formatter</a>
<a href="send_email.html" class="sidebar_item">Send email</a>
<a href="sessions_and_cookies.html" class="sidebar_item">Sessions and cookies</a>
<a href="service_layer.html" class="sidebar_item selected">Service layer</a>
<a href="exception_handling.html" class="sidebar_item">Exception handling</a>
            <h3>Sidesteps</h3>
            <a href="../sidesteps/sidesteps.html" class="sidebar_item">Sidesteps</a>
<a href="../sidesteps/jetty_server_notes.html" class="sidebar_item">Jetty server notes</a>
<a href="../sidesteps/embedded_server.html" class="sidebar_item">Embedded server</a>
        </td></tr>
        <tr><td class="bottom" valign="bottom">
            Generated by <a href="https://github.com/arctrong/md2html">md2html_py</a> 1.0.4
        </td></tr>
    </table>
</div>

<p style="font-size:44px;font-weight:bold;margin:0 0 30px 0;">Service layer</p>

<div class="toc">
<ul>
<li><a href="#project-arrangements">Project arrangements</a></li>
<li><a href="#local-mail-server-setup">Local mail server setup</a></li>
<li><a href="#implementing-spring-mail-api">Implementing Spring mail API</a></li>
<li><a href="#best-practices">Best practices</a><ul>
<li><a href="#using-properties-file">Using properties file</a></li>
<li><a href="#using-logger">Using logger</a></li>
</ul>
</li>
<li><a href="#add-result-calculation-service">Add result calculation service</a></li>
</ul>
</div>
<hr />
<p>Apr 4, 2023</p>
<h1 id="project-arrangements">Project arrangements</h1>
<p>Maven project <code>web-app-spring-adv3</code> was copied to <code>web-app-spring-adv4</code> to leave the previous
version untouched.</p>
<blockquote>
<p>Git commit: <code>3d6cecc8078c7ab3049832f2254ed241740d31ad</code> project web-app-spring-adv4 copied from project web-app-spring-adv3</p>
</blockquote>
<hr />
<p><a name="local_mail_server_setup"></a></p>
<h1 id="local-mail-server-setup">Local mail server setup</h1>
<p>Google mail service toughened up its security requirement so it's become too complex or impossible
for testing mail sending while this application development.</p>
<p><a href="../sidesteps/sidesteps.html#setup_local_mail_server">Another solution</a> was applied instead.</p>
<hr />
<h1 id="implementing-spring-mail-api">Implementing Spring mail API</h1>
<p>[<a href="../references.html#ref_2_15">2.15</a>, <a href="https://youtu.be/laZnez5VzV4?t=800">13:20</a>]</p>
<p>Add the following dependencies to the POM:</p>
<pre class="highlight"><code class="language-xml">        .  .  .
        &lt;dependency&gt;
            &lt;groupId&gt;javax.mail&lt;/groupId&gt;
            &lt;artifactId&gt;mail&lt;/artifactId&gt;
            &lt;version&gt;1.4.7&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
            &lt;version&gt;${org.springframework.version}&lt;/version&gt;
        &lt;/dependency&gt;
        .  .  .</code></pre>
<p>To the <a href="../code/web-app-spring-adv4/src/main/java/springmvcstudy2/controllers/EmailController.java.html"><code>EmailController</code></a>
class add the email sending function:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @Autowired
    private MyAppEmailService emailService;
    .  .  .
    @RequestMapping("/process-email")
    public String processEmail(
            @SessionAttribute("userInfoDto") UserInfoValidatedDto userInfoDto,
            @ModelAttribute SendEmailDto sendEmailDto) {

        emailService.sendEmail(userInfoDto.getName1(), sendEmailDto.getUserEmail(), "GOOD");

        return "process-email-page";
    }
    .  .  .</code></pre>
<p><code>MyAppEmailService</code> is an interface. The implementation is the <a href="../code/web-app-spring-adv4/src/main/java/springmvcstudy2/service/MyAppEmailServiceImpl.java.html"><code>MyAppEmailServiceImpl</code></a>
class:</p>
<pre class="highlight"><code class="language-code">@Service
public class MyAppEmailServiceImpl implements MyAppEmailService {

    @Autowired
    private JavaMailSender mailSender;

    @Override
    public void sendEmail(String userName, String userEmail, String result) {
        SimpleMailMessage newEmail = new SimpleMailMessage();
        newEmail.setFrom("noreply@myapp.com");
        newEmail.setTo(userEmail);
        newEmail.setSubject("Test massage (may be deleted any time)");
        newEmail.setText("Hi " + userName + ", your result is: " + result);

        mailSender.send(newEmail);
    }
}</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a name="index_entry_index_1"></a>
The <code>@Service</code> annotation is itself annotated with the <code>@Component</code> annotation.</p>
</div>
<p>The autowired <code>mailSender</code> comes from the <a href="../code/web-app-spring-adv4/src/main/java/springmvcstudy2/config/MyApplicationConfig.java.html"><code>MyApplicationConfig</code></a>
configuration class:</p>
<pre class="highlight"><code class="language-code">    .  .  .
    @Bean
    public JavaMailSender mailSender() {
        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();
        mailSender.setHost("localhost");
        mailSender.setPort(2500);
        mailSender.setUsername("someone@somewhere.com"); // looks like it's not used
        mailSender.setPassword("someone"); // looks like it's not used
        return mailSender;
    }
    .  .  .</code></pre>
<p>For testing need to go through the following steps:</p>
<ul>
<li>start MailSlurper (or other) local mail server like this: <code>mailslurper.exe</code> (see above for
    the setup instructions);</li>
<li>in a browser navigate to <a href="http://localhost:8025">http://localhost:8025</a> (or other URL if configured differently)
    and assure the mail server's UI works;</li>
<li>copy the built <code>*.war</code> file to the <code>%JETTY_BASE%/webapps</code> directory;</li>
<li>start the server with the command <code>java -jar %JETTY_HOME%\start.jar</code>, or see 
    <a href="../sidesteps/sidesteps.html#remote_server_debugging">here</a> if debugging is required;</li>
<li><a href="http://localhost:8080/web-app-spring-adv4/ui/validate">http://localhost:8080/web-app-spring-adv4/ui/validate</a>, fill up the field and press the 
    "Send" button;</li>
<li><a href="http://localhost:8080/web-app-spring-adv4/ui/validate-submit?name1=Bob&amp;name2=Welma&amp;notARobot=true&amp;_notARobot=on">http://localhost:8080/web-app-spring-adv4/ui/validate-submit?name1=...</a>,
    click the "Send result to your email" link;</li>
<li><a href="http://localhost:8080/web-app-spring-adv4/ui/sendEmail">http://localhost:8080/web-app-spring-adv4/ui/sendEmail</a>, enter any email and press the 
    "Send" button.</li>
</ul>
<p>If the message is sent successfully the following email must be visible in the email server UI:</p>
<p><img alt="" src="../../pict/mail_is_sent.png" /></p>
<blockquote>
<p>Git commit: <a href="../patches/943d19db5647d17fc5a42eae2070fe0003180edf.html"><code>943d19db5647d17fc5a42eae2070fe0003180edf</code></a>
sending email implemented</p>
</blockquote>
<hr />
<h1 id="best-practices">Best practices</h1>
<p>[<a href="../references.html#ref_2_15">2.15</a>, <a href="https://youtu.be/laZnez5VzV4?t=3019">50:19</a>]</p>
<p><a name="index_entry_index_2"></a></p>
<h2 id="using-properties-file">Using properties file</h2>
<blockquote>
<p>Git commit: <a href="../patches/c3637ff1c2615984c7d5d1e8370db443dfdfb08e.html"><code>c3637ff1c2615984c7d5d1e8370db443dfdfb08e</code></a>
using properties file</p>
</blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code>@PropertySource</code> annotation may be used several times to define several property sources.
Also the <code>@PropertySources</code> annotation may be used that allow specify severs <code>@PropertySource</code>
annotation inside.</p>
</div>
<p><a name="index_entry_index_3"></a></p>
<h2 id="using-logger">Using logger</h2>
<p>[<a href="../references.html#ref_2_15">2.15</a>, <a href="https://youtu.be/laZnez5VzV4?t=4294">1:11:34</a>]</p>
<blockquote>
<p>Git commit: <a href="../patches/1a95f6e32e101c1a2ceb76305558718ae65dff0b.html"><code>1a95f6e32e101c1a2ceb76305558718ae65dff0b</code></a>
using a logger</p>
</blockquote>
<hr />
<h1 id="add-result-calculation-service">Add result calculation service</h1>
<p>[<a href="../references.html#ref_2_15">2.15</a>, <a href="https://youtu.be/laZnez5VzV4?t=5349">1:29:09</a>]</p>
<p>The implementation is pretty similar to the previous one so see the below commit for the exact
details.</p>
<blockquote>
<p>Git commit: <a href="../patches/db2dba43f74d040855c6cf863d7d44b71d57a32e.html"><code>db2dba43f74d040855c6cf863d7d44b71d57a32e</code></a>
calculation service implemented</p>
</blockquote>
<p>&nbsp;</p>
<hr />

<p style="margin-top:0px;margin-bottom:0px;text-align:right;"><a href="sessions_and_cookies.html" 
title="Previous: Sessions and cookies"><img src="../../layout/pict/previous_page.png"/></a>

<a href="exception_handling.html" title="Next: Exception handling"><img 
src="../../layout/pict/next_page.png"/></a>
</p>

<div style="height: 1000px;"><p>&nbsp;</p></div>




</body>
</html>
